<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#5B7B7A" />
  <title>Sistema de Avalúos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* TODOS LOS ESTILOS ORIGINALES SE MANTIENEN INTACTOS */
    :root {
      --primary: #5B7B7A;
      --primary-light: #8AA6A5;
      --primary-dark: #3A5958;
      --secondary: #A6B5A5;
      --accent: #8C9B9A;
      --success: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
      --text: #2D3748;
      --text-light: #718096;
      --text-lighter: #A0AEC0;
      --bg: #F9FAFB;
      --bg-card: #FFFFFF;
      --bg-hover: #F8FAFC;
      --border: #E2E8F0;
      --border-light: #F1F5F9;
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.02), 0 1px 2px 0 rgba(0, 0, 0, 0.03);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.03), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.03), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
      --radius: 12px;
      --radius-sm: 8px;
      --radius-lg: 16px;
      --space-xs: 8px;
      --space-sm: 16px;
      --space-md: 24px;
      --space-lg: 32px;
      --space-xl: 48px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; }

    body { background: var(--bg); color: var(--text); line-height: 1.6; min-height: 100vh; }

    .app-container { max-width: 1200px; margin: 0 auto; padding: 0 var(--space-md); }

    .app-header {
      background: var(--bg-card);
      padding: var(--space-md) 0;
      position: sticky; top: 0; z-index: 100;
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
      margin-bottom: var(--space-lg);
    }
    .app-header h1 { font-size: 1.75rem; font-weight: 600; display: flex; align-items: center; gap: var(--space-sm); color: var(--primary); }
    .app-header h1 i { background: rgba(91,123,122,.1); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }

    
    .app-header h1 img {
        background: transparent !important;
    }

    .floating-actions {
      position: fixed;
      top: 100px;
      right: 24px;
      z-index: 99;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .floating-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s ease;
      font-size: 1.2rem;
    }
    .floating-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    .floating-btn:active {
      transform: translateY(0);
    }
    @media (max-width: 768px){
      .floating-actions {
        top: 90px;
        right: 16px;
      }
      .floating-btn {
        width: 50px;
        height: 50px;
        font-size: 1.1rem;
      }
    }

    .form-steps { display: flex; justify-content: space-between; margin-bottom: var(--space-xl); position: relative; padding: 0 var(--space-md); }
    .form-steps::before { content: ''; position: absolute; top: 24px; left: var(--space-md); right: var(--space-md); height: 2px; background: var(--border); z-index: 1; }
    .step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 2; cursor: pointer; transition: .3s; flex: 1; }
    .step-number { width: 48px; height: 48px; border-radius: 50%; background: var(--bg); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-weight: 600; margin-bottom: var(--space-xs); transition: .3s; }
    .step-label { font-size: .875rem; font-weight: 500; color: var(--text-light); text-align: center; transition: .3s; }
    .step.active .step-number { background: var(--primary); border-color: var(--primary); color:#fff; }
    .step.active .step-label { color: var(--primary); font-weight: 600; }
    .step.completed .step-number { background: var(--success); border-color: var(--success); color:#fff; }

    .card { background: var(--bg-card); border-radius: var(--radius-lg); padding: var(--space-xl); margin: var(--space-lg) 0; box-shadow: var(--shadow); border: 1px solid var(--border); transition: .3s; }
    .card:hover { box-shadow: var(--shadow-lg); }
    .card h2 { font-size: 1.5rem; color: var(--text); margin-bottom: var(--space-lg); font-weight: 600; display: flex; align-items: center; gap: var(--space-sm); }
    .card h2 i { background: rgba(91,123,122,.1); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }

    .form-section { margin-bottom: var(--space-xl); display: none; animation: fadeIn .5s ease; }
    .form-section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to{ opacity:1; transform:translateY(0);} }
    .form-section-title { font-size: 1.25rem; color: var(--text); margin-bottom: var(--space-md); font-weight: 600; display: flex; align-items: center; gap: var(--space-sm); padding-bottom: var(--space-sm); border-bottom: 1px solid var(--border-light); }
    .form-section-title i { background: rgba(91,123,122,.1); width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }

    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap: var(--space-md); }
    .form-group { display: flex; flex-direction: column; }
    .form-group label { font-size: .9rem; font-weight: 500; color: var(--text); margin-bottom: var(--space-xs); display: flex; align-items: center; gap: var(--space-xs); }
    .required::after { content:'*'; color: var(--error); margin-left: 4px; }
    .form-group input,.form-group select,.form-group textarea { padding: 14px 16px; border:1px solid var(--border); border-radius: var(--radius); font-size:1rem; transition:.2s; background: var(--bg-card); color: var(--text); }
    .form-group input:focus,.form-group select:focus,.form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(91,123,122,.1); }
    .form-help { font-size: .85rem; color: var(--text-light); margin-top: var(--space-xs); }

    .typology-selector{ margin-top: var(--space-md); }
    .typology-trigger{ background: var(--bg-card); border:1px solid var(--border); border-radius: var(--radius); padding:20px; cursor:pointer; display:flex; align-items:center; gap:var(--space-sm); transition:.2s; }
    .typology-trigger:hover{ border-color: var(--primary); background: var(--bg-hover); }
    .typology-trigger:after{ content:"▼"; font-size:.8rem; margin-left:auto; transition: transform .3s; color: var(--primary); }
    .typology-trigger.active:after{ transform: rotate(180deg); }
    .selected-image{ width:60px; height:60px; border-radius: var(--radius); object-fit: cover; flex-shrink: 0; }
    .selected-text{ display:flex; flex-direction:column; flex:1; }
    .selected-type{ font-weight: 600; color: var(--primary); font-size:1rem; margin-bottom:4px; }
    .selected-title{ font-weight: 500; color: var(--text); font-size:.9rem; }
    .selected-price{ font-size:.85rem; color: var(--text-light); margin-top:4px; }

    #norte-propietario,#sur-propietario,#oriente-propietario,#poniente-propietario,
    #norte-metros,#sur-metros,#oriente-metros,#poniente-metros{
      background: var(--bg-card)!important; border:1px solid var(--border)!important; color: var(--text)!important;
    }

    .table-ui{ width:100%; border-collapse:collapse; margin: var(--space-md) 0; background: var(--bg-card); border-radius: var(--radius); overflow:hidden; border:1px solid var(--border); }
    .table-ui th{ background: rgba(91,123,122,.05); color: var(--text); padding:16px; text-align:left; font-weight:600; font-size:.9rem; }
    .table-ui td{ padding:16px; border-bottom:1px solid var(--border-light); }
    .table-ui input, .table-ui select{ width:100%; padding:10px 12px; border:1px solid var(--border); border-radius: var(--radius-sm); background: var(--bg-card); }

    .form-section-title + .form-grid + .form-section-title{ margin-top: var(--space-lg); }

    .btn-primary{ background: var(--primary); color:#fff; border:none; border-radius: var(--radius); padding:16px 24px; font-size:1rem; font-weight:500; cursor:pointer; transition:.2s; display:flex; align-items:center; justify-content:center; gap:10px; margin-top: var(--space-sm); }
    .btn-primary:hover{ background: var(--primary-dark); transform: translateY(-1px); box-shadow: var(--shadow-md); }
    .btn-secondary{ background:transparent; color: var(--primary); border:2px solid var(--primary); border-radius: var(--radius); padding:14px 22px; font-size:1rem; font-weight:500; cursor:pointer; transition:.2s; display:flex; align-items:center; justify-content:center; gap:10px; }
    .btn-secondary:hover{ background: var(--primary); color:#fff; }

    .btn-small{ padding:10px 14px; font-size:.9rem; border-radius:10px; }

    .form-navigation{ display:flex; justify-content:space-between; margin-top: var(--space-xl); padding-top: var(--space-md); border-top:1px solid var(--border-light); }

    .result-section{ display:none; animation: fadeIn .5s ease; }
    .result-section.active{ display:block; }
    .result-grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom: var(--space-lg); }
    .result-item{ text-align:center; padding:24px 16px; background: rgba(91,123,122,.03); border-radius: var(--radius); border:1px solid var(--border-light); }
    .result-item .label{ font-size:.85rem; color: var(--text-light); margin-bottom:8px; font-weight:500;}
    .result-item .value{ font-size:1.2rem; font-weight:700; color: var(--primary); }
    .result-total{ text-align:center; padding:32px; background: rgba(91,123,122,.05); border-radius: var(--radius); margin-top:24px; border:1px solid var(--border-light); }
    .result-total .label{ font-size:1rem; margin-bottom:12px; color: var(--text); font-weight:500;}
    .result-total .value{ font-size:2rem; font-weight:700; color: var(--primary); }

    .catalog-modal{ position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,.5); display:none; justify-content:center; align-items:center; z-index:1000; padding:20px; }
    .catalog-modal.active{ display:flex; }
    .modal-content{ background: var(--bg-card); border-radius: var(--radius-lg); width:100%; max-width:600px; max-height:80vh; overflow-y:auto; padding:0; }
    .modal-header{ padding:24px; border-bottom:1px solid var(--border-light); position:sticky; top:0; background: var(--bg-card); border-radius: var(--radius-lg) var(--radius-lg) 0 0; }
    .modal-header h3{ color: var(--text); font-size:1.3rem; display:flex; align-items:center; gap:12px; font-weight:600; }
    .modal-close{ position:absolute; top:24px; right:24px; background:none; border:none; font-size:1.2rem; cursor:pointer; color: var(--text-light); width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:.2s; }
    .modal-close:hover{ background: var(--border-light); }

    .catalog-item-modal{ padding:20px; border-bottom:1px solid var(--border-light); cursor:pointer; transition:.2s; }
    .catalog-item-modal:last-child{ border-bottom:none; }
    .catalog-item-modal:hover{ background: rgba(91,123,122,.03); }
    .catalog-item-content{ display:flex; gap:16px; align-items:flex-start; }
    .catalog-image-modal{ width:80px; height:80px; border-radius: var(--radius); object-fit:cover; flex-shrink:0; }
    .catalog-text-modal{ flex:1; }
    .catalog-type-modal{ font-weight:600; color: var(--primary); font-size:1.1rem; margin-bottom:4px; }
    .catalog-title-modal{ font-weight:500; color: var(--text); font-size:1rem; margin-bottom:4px; }
    .catalog-price-modal{ font-size:1rem; font-weight:600; color: var(--text); margin-bottom:8px; }
    .catalog-description-modal{ font-size:.9rem; color: var(--text-light); line-height:1.5; margin-bottom:12px; }
    .catalog-features-modal{ list-style:none; }
    .catalog-features-modal li{ padding:4px 0; display:flex; align-items:center; gap:8px; font-size:.85rem; color: var(--text); }
    .catalog-features-modal li i{ color: var(--primary); font-size:.8rem; }

    .select-button{ background: var(--primary); color:#fff; border:none; border-radius: var(--radius); padding:12px 20px; font-weight:500; cursor:pointer; margin-top:12px; width:100%; transition:.2s; display:flex; align-items:center; justify-content:center; gap:8px; }
    .select-button:hover{ background: var(--primary-dark); }

    #save-btn,#pdf-btn{ position:fixed; right:24px; z-index:100; background: var(--primary); color:#fff; border:none; border-radius:50px; padding:14px 20px; font-weight:500; box-shadow: var(--shadow-md); display:none; cursor:pointer; transition:.2s; align-items:center; gap:8px; font-size:.9rem; }
    #save-btn:hover,#pdf-btn:hover{ transform: translateY(-2px); box-shadow: var(--shadow-lg); }
    #save-btn{ bottom:100px; }
    #pdf-btn{ bottom:170px; background: var(--secondary); }

    .loading-overlay{ position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,.9); display:none; justify-content:center; align-items:center; z-index:2000; flex-direction:column; gap: var(--space-md); }
    .loading-spinner{ width:48px; height:48px; border:4px solid var(--border); border-left:4px solid var(--primary); border-radius:50%; animation: spin 1s linear infinite; }
    @keyframes spin{ 0%{ transform: rotate(0deg);} 100%{ transform: rotate(360deg);} }

    .auth-overlay{ position:fixed; inset:0; background: rgba(0,0,0,.45); display:none; z-index:1500; align-items:center; justify-content:center; padding:24px; }
    .auth-panel{ width:100%; max-width:880px; }
    .auth-grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:12px; }
    .auth-col{ border:1px solid var(--border); border-radius: var(--radius); padding:12px; background:#fff; }
    .auth-col-title{ font-weight:600; margin-bottom:8px; }
    .auth-input{ width:100%; margin-bottom:8px; padding:10px; border:1px solid var(--border); border-radius:8px; }
    .auth-close{ position:absolute; top:18px; right:18px; background:none; border:none; color:#fff; font-size:1.2rem; cursor:pointer; }
    
    @media (max-width:768px){
      .app-container{ padding:0 var(--space-sm); }
      .card{ padding: var(--space-md); margin: var(--space-md) 0; }
      .form-grid,.characteristics-grid,.result-grid{ grid-template-columns:1fr; }
      .form-steps{ flex-direction:column; gap: var(--space-md); }
      .form-steps::before{ display:none; }
      .step{ flex-direction:row; gap: var(--space-sm); }
      .step-label{ text-align:left; }
      #save-btn,#pdf-btn{ right:16px; bottom:80px; }
      #pdf-btn{ bottom:140px; }
    }

    #username-modal .modal-content {
      max-width: 400px;
    }
    #username-modal .form-group {
      margin-bottom: 0;
    }

    .appraisal-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }

    .appraisal-item:hover {
      border-color: var(--primary);
      box-shadow: var(--shadow);
    }

    .appraisal-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 8px;
    }

    .appraisal-date {
      font-weight: 600;
      color: var(--primary);
    }

    .appraisal-actions {
      display: flex;
      gap: 8px;
    }

    .appraisal-details {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .appraisal-details div {
      margin-bottom: 4px;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 0.8rem;
      border-radius: 6px;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-light);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    
    #user-box {
      display: none;
      align-items: center;
      gap: 12px;
      justify-content: space-between;
      margin-top: 16px;
      margin-bottom: 24px;
      padding: 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    #user-box[style*="display: flex"] {
      margin-top: 16px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      #user-box {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      #user-box .btn-secondary {
        width: 100%;
        justify-content: center;
      }
    }

    
    @media (max-width: 768px){
      .catalog-modal .modal-content {
        max-width: 95vw;
        max-height: 90vh;
        margin: 20px 10px;
      }
      
      .catalog-item-content {
        flex-direction: column;
        text-align: center;
      }
      
      .catalog-image-modal {
        width: 100%;
        height: 150px;
        margin-bottom: 12px;
      }
      
      .catalog-text-modal {
        width: 100%;
      }
      
      .catalog-features-modal {
        text-align: left;
        max-height: 120px;
        overflow-y: auto;
        margin-bottom: 10px;
        padding: 0 10px;
      }

      .table-ui {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        font-size: 0.8rem;
      }
      
      .table-ui th,
      .table-ui td {
        padding: 12px 8px;
        min-width: 80px;
      }
      
      #tablaTerreno th,
      #tablaTerreno td {
        min-width: 70px;
        font-size: 0.75rem;
      }
      
      #tablaTerreno th:nth-child(1),
      #tablaTerreno td:nth-child(1) {
        min-width: 100px;
      }
      
      #tablaTerreno th:nth-child(9),
      #tablaTerreno td:nth-child(9),
      #tablaTerreno th:nth-child(10),
      #tablaTerreno td:nth-child(10) {
        min-width: 90px;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: var(--space-sm);
      }
      
      .characteristics-grid {
        grid-template-columns: 1fr;
      }
      
      .form-group input,
      .form-group select,
      .form-group textarea {
        padding: 12px;
        font-size: 16px;
      }
      
      .card {
        padding: var(--space-md);
        margin: var(--space-sm) 0;
      }
      
      .card h2 {
        font-size: 1.3rem;
        margin-bottom: var(--space-md);
      }

      .form-navigation {
        flex-direction: column;
        gap: 12px;
      }
      
      .form-navigation button {
        width: 100%;
        padding: 14px 20px;
      }
      
      .floating-actions {
        top: 80px;
        right: 12px;
      }
      
      .floating-btn {
        width: 48px;
        height: 48px;
        font-size: 1rem;
      }
      
      #save-btn, #pdf-btn {
        right: 12px;
        bottom: 70px;
        padding: 12px 16px;
        font-size: 0.8rem;
      }
      
      #pdf-btn {
        bottom: 130px;
      }

      .result-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .result-item {
        padding: 16px 12px;
      }
      
      .result-total {
        padding: 24px 16px;
      }
      
      .result-total .value {
        font-size: 1.5rem;
      }
      
      .appraisal-item {
        padding: 12px;
      }
      
      .appraisal-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .appraisal-actions {
        width: 100%;
        justify-content: space-between;
      }

      .typology-trigger {
        padding: 16px;
      }
      
      .selected-image {
        width: 50px;
        height: 50px;
      }
      
      .selected-text {
        min-width: 0;
      }
      
      .selected-type {
        font-size: 0.9rem;
      }
      
      .selected-title {
        font-size: 0.8rem;
      }
      
      .selected-price {
        font-size: 0.75rem;
      }

      .auth-grid {
        grid-template-columns: 1fr;
      }
      
      .auth-panel {
        margin: 10px;
      }
      
      .auth-overlay {
        padding: 10px;
      }

      .form-steps {
        flex-direction: column;
        gap: var(--space-sm);
        padding: 0;
      }
      
      .form-steps::before {
        display: none;
      }
      
      .step {
        flex-direction: row;
        gap: var(--space-sm);
        width: 100%;
        padding: 8px 0;
      }
      
      .step-number {
        width: 40px;
        height: 40px;
        margin-bottom: 0;
      }
      
      .step-label {
        text-align: left;
        flex: 1;
      }

      .app-header h1 {
        font-size: 1.4rem;
      }
      
      .app-header h1 i {
        width: 40px;
        height: 40px;
      }
      
      .form-section-title {
        font-size: 1.1rem;
      }
      
      .form-section-title i {
        width: 32px;
        height: 32px;
      }

      #gmap {
        height: 300px;
      }

      .btn-primary, .btn-secondary {
        padding: 14px 20px;
        font-size: 0.9rem;
      }
      
      .btn-small {
        padding: 8px 12px;
        font-size: 0.8rem;
      }

      .modal-body {
        max-height: 60vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      #all-appraisals-list,
      #my-appraisals-list {
        max-height: 50vh;
      }
    }

    /* Estilos para el visor de imágenes */
    #image-viewer-modal .modal-content {
      background: transparent !important;
      box-shadow: none !important;
    }

    #image-viewer-modal .modal-close {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      z-index: 1001;
      border: 2px solid rgba(255,255,255,0.5);
    }

    #image-viewer-modal .modal-close:hover {
      background: rgba(0,0,0,0.9);
      transform: scale(1.1);
    }

    .catalog-image-modal {
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 2px solid transparent;
    }

    .catalog-image-modal:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    /* Efecto de overlay en hover para las imágenes */
    .catalog-item-content {
      position: relative;
    }

    .catalog-image-modal::after {
      content: '\f002';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      color: white;
      background: rgba(91, 123, 122, 0.8);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease;
      opacity: 0;
    }

    .catalog-image-modal:hover::after {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    /* Estilos para subida de imágenes */
    .image-upload-container {
      margin-top: 12px;
    }

    .upload-area {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: var(--space-lg);
      text-align: center;
      transition: all 0.3s ease;
      background: var(--bg-hover);
      cursor: pointer;
    }

    .upload-area:hover, .upload-area.dragover {
      border-color: var(--primary);
      background: rgba(91, 123, 122, 0.05);
    }

    .image-preview-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }

    .image-preview-item {
      position: relative;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .image-preview-item img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      display: block;
    }

    .image-preview-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      background: var(--error);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 0.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-preview-info {
      padding: 8px;
      background: var(--bg-card);
      font-size: 0.75rem;
      color: var(--text-light);
    }

    /* CORRECCIÓN ESPECÍFICA PARA EL VISOR DE IMÁGENES */
    #image-viewer-modal {
      z-index: 2000 !important;
    }
    
    #image-viewer-modal .modal-content {
      z-index: 2001 !important;
    }

    /* NUEVOS ESTILOS PARA PESTAÑAS Y ACORDEONES */
    .typology-tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      background: var(--bg-card);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .typology-tab {
      flex: 1;
      padding: 16px;
      text-align: center;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      color: var(--text-light);
    }

    .typology-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      background: rgba(91, 123, 122, 0.05);
    }

    .typology-tab:hover:not(.active) {
      background: var(--bg-hover);
      color: var(--text);
    }

    .typology-tab-content {
      display: none;
      padding: 20px;
    }

    .typology-tab-content.active {
      display: block;
    }

    .typology-accordion {
      margin-bottom: 8px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .typology-accordion-header {
      padding: 16px 20px;
      background: var(--bg-hover);
      border: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      color: var(--text);
      transition: all 0.3s ease;
    }

    .typology-accordion-header:hover {
      background: rgba(91, 123, 122, 0.1);
    }

    .typology-accordion-header.active {
      background: rgba(91, 123, 122, 0.15);
      color: var(--primary);
    }

    .typology-accordion-icon {
      transition: transform 0.3s ease;
    }

    .typology-accordion-header.active .typology-accordion-icon {
      transform: rotate(180deg);
    }

    .typology-accordion-content {
      display: none;
      padding: 0;
      background: var(--bg-card);
    }

    .typology-accordion-content.active {
      display: block;
    }

    .typology-variants {
      display: grid;
      gap: 0;
    }

    .typology-variant {
      padding: 20px;
      border-bottom: 1px solid var(--border-light);
      transition: all 0.3s ease;
    }

    .typology-variant:last-child {
      border-bottom: none;
    }

    .typology-variant:hover {
      background: rgba(91, 123, 122, 0.03);
    }

    .variant-content {
      display: flex;
      gap: 16px;
      align-items: flex-start;
    }

    .variant-images {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .variant-image {
      width: 100px;
      height: 80px;
      border-radius: var(--radius-sm);
      object-fit: cover;
      cursor: pointer;
      transition: transform 0.3s ease;
      border: 1px solid var(--border);
    }

    .variant-image:hover {
      transform: scale(1.05);
      border-color: var(--primary);
    }

    .variant-details {
      flex: 1;
    }

    .variant-title {
      font-weight: 600;
      color: var(--primary);
      font-size: 1rem;
      margin-bottom: 8px;
    }

    .variant-price {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--success);
      margin-bottom: 12px;
    }

    .variant-features {
      list-style: none;
      margin-bottom: 12px;
    }

    .variant-features li {
      padding: 4px 0;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.4;
    }

    .variant-features li i {
      color: var(--primary);
      font-size: 0.8rem;
      margin-top: 2px;
      flex-shrink: 0;
    }

    .variant-description {
      font-size: 0.8rem;
      color: var(--text-light);
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(91, 123, 122, 0.03);
      border-radius: var(--radius-sm);
    }

    .variant-details-section {
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(91, 123, 122, 0.02);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--primary);
    }

    .variant-details-section h4 {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .variant-details-section ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .variant-details-section li {
      padding: 2px 0;
      font-size: 0.8rem;
      color: var(--text);
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }

    .variant-details-section li:before {
      content: "•";
      color: var(--primary);
      font-weight: bold;
      flex-shrink: 0;
    }

    @media (max-width: 768px) {
      .typology-tabs {
        flex-direction: column;
      }
      
      .typology-tab {
        padding: 12px;
        border-bottom: 1px solid var(--border);
        border-left: 3px solid transparent;
      }
      
      .typology-tab.active {
        border-left-color: var(--primary);
        border-bottom-color: var(--border);
      }
      
      .variant-content {
        flex-direction: column;
      }
      
      .variant-images {
        justify-content: center;
      }
      
      .variant-image {
        width: 120px;
        height: 90px;
      }
      
      .variant-details-section {
        padding: 10px;
      }
    }
  </style>
</head>

<body>
  <!-- TODO EL HTML ORIGINAL SE MANTIENE INTACTO -->
  <div class="app-container">
    <header class="app-header">
      <h1><img src="http://visione.gt/wp-content/uploads/2020/12/Logo-sitio.png" alt="Logo" style="width: 200px; height: 60px; border-radius: 12px; object-fit: contain; background: rgba(91,123,122,.1); padding: 4px;"> Sistema de Avalúos</h1>
    </header>

    <div class="floating-actions">
      <button class="floating-btn" id="all-appraisals-btn" title="Lista de Avalúos">
        <i class="fas fa-list"></i>
      </button>
      <button class="floating-btn" id="my-appraisals-btn" title="Mis Avalúos">
        <i class="fas fa-user"></i>
      </button>
    </div>

    <!-- Los modales originales se mantienen intactos -->
    <div class="catalog-modal" id="username-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-user-plus"></i> Completa tu perfil</h3>
        </div>
        <div class="modal-body" style="padding: 24px;">
          <div class="form-group">
            <label for="google-username" class="required">Elige un nombre de usuario</label>
            <input type="text" id="google-username" placeholder="Ingresa tu username" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: var(--radius);" />
            <div class="form-help">Este nombre se mostrará en tus avalúos</div>
          </div>
          <button class="btn-primary" id="save-google-username" style="width: 100%; margin-top: 16px;">
            <i class="fas fa-check"></i> Guardar y continuar
          </button>
        </div>
      </div>
    </div>

    <div class="catalog-modal" id="all-appraisals-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-list"></i> Lista de Avalúos</h3>
          <button class="modal-close" onclick="closeModal('all-appraisals-modal')">&times;</button>
        </div>
        <div class="modal-body" style="padding: 20px;">
          <div class="form-group">
            <input type="text" id="search-appraisals" placeholder="Buscar avalúos..." style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: var(--radius);">
          </div>
          <div id="all-appraisals-list" style="max-height: 400px; overflow-y: auto;">
            
          </div>
        </div>
      </div>
    </div>

    <div class="catalog-modal" id="my-appraisals-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-user"></i> Mis Avalúos</h3>
          <button class="modal-close" onclick="closeModal('my-appraisals-modal')">&times;</button>
        </div>
        <div class="modal-body" style="padding: 20px;">
          <div id="my-appraisals-list" style="max-height: 400px; overflow-y: auto;">
            
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para visualizar imagen grande -->
    <div class="catalog-modal" id="image-viewer-modal" style="z-index: 2000;">
      <div class="modal-content" style="max-width: 90vw; max-height: 90vh; background: transparent; box-shadow: none; z-index: 2001;">
        <button class="modal-close" onclick="closeImageViewer()" style="position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; z-index: 2002;">
          &times;
        </button>
        <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
          <img id="full-size-image" src="" alt="Imagen en tamaño completo" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: var(--radius);">
        </div>
      </div>
    </div>

    <div class="auth-overlay" id="auth-overlay">
      <button class="auth-close" title="Cerrar" onclick="/* no permitir cerrar sin login */void(0)">×</button>
      <div class="auth-panel card">
        <h2><i class="fas fa-user-lock"></i> Acceso requerido</h2>
        <p style="margin-bottom:12px;color:var(--text-light)">
          Inicia sesión para usar el Sistema de Avalúos. Si creas cuenta con correo, debes confirmar desde tu email.
        </p>
        <div class="auth-grid">
          <div class="auth-col">
            <div class="auth-col-title">Con correo</div>
            <input id="auth-email" type="email" placeholder="tu@correo.com" class="auth-input">
            <input id="auth-pass" type="password" placeholder="Contraseña" class="auth-input">
            <input id="auth-username" type="text" placeholder="Username (nuevo)" class="auth-input">
            <button class="btn-primary" type="button" onclick="__signInWithEmail(
              document.getElementById('auth-email').value,
              document.getElementById('auth-pass').value
            )">
              <i class="fas fa-right-to-bracket"></i> Iniciar sesión
            </button>
            <button class="btn-secondary" type="button" style="margin-top:8px" onclick="__signUpWithEmail(
              document.getElementById('auth-email').value,
              document.getElementById('auth-pass').value,
              document.getElementById('auth-username').value
            )">
              <i class="fas fa-user-plus"></i> Crear cuenta
            </button>
            <button class="btn-secondary" type="button" style="margin-top:8px"
              onclick="__resendVerification(document.getElementById('auth-email').value)">
              <i class="fas fa-envelope"></i> Reenviar correo de verificación
            </button>
          </div>

          <div class="auth-col">
            <div class="auth-col-title">Con Google</div>
            <button class="btn-primary" type="button" onclick="__signInWithGoogle()">
              <i class="fab fa-google"></i> Continuar con Google
            </button>
            <div class="form-help" style="margin-top:8px">
              Requiere configurar Google OAuth en Supabase/Google Cloud.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="user-box" style="display:none;align-items:center;gap:12px;justify-content:space-between;margin-top:-16px;">
      <div style="color:var(--text-light)">
        <i class="fas fa-circle-user"></i>
        <span data-user-name></span> · <span data-user-email></span>
      </div>
      <button class="btn-secondary" type="button" onclick="__signOut()">
        <i class="fas fa-arrow-right-from-bracket"></i> Cerrar sesión
      </button>
    </div>

    <div class="form-steps">
      <div class="step active" data-step="1">
        <div class="step-number">1</div>
        <div class="step-label">Información General</div>
      </div>
      <div class="step" data-step="2">
        <div class="step-number">2</div>
        <div class="step-label">Características</div>
      </div>
      <div class="step" data-step="3">
        <div class="step-number">3</div>
        <div class="step-label">Cálculos</div>
      </div>
      <div class="step" data-step="4">
        <div class="step-number">4</div>
        <div class="step-label">Resultados</div>
      </div>
    </div>

    <div class="card">
      <div class="form-section active" data-step="1">
        <h2><i class="fas fa-info-circle"></i> Información General</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="associate-name" class="required">Nombre del Asociado</label>
            <input type="text" id="associate-name" placeholder="Ingrese el nombre completo" required />
            <div class="form-help">Nombre completo del solicitante</div>
          </div>
          <div class="form-group">
            <label for="address" class="required">Dirección de la Propiedad</label>
            <input type="text" id="address" placeholder="Escriba y elija de las sugerencias" required />
            <div class="form-help">La dirección se completará automáticamente</div>
          </div>
          <div class="form-group">
            <label for="geo-lat">Latitud</label>
            <input type="text" id="geo-lat" placeholder="-" readonly />
          </div>
          <div class="form-group">
            <label for="geo-lng">Longitud</label>
            <input type="text" id="geo-lng" placeholder="-" readonly />
          </div>
          <div class="form-group">
            <label for="construction-area" class="required">Área Construida (m²)</label>
            <input type="number" id="construction-area" placeholder="Ej: 120" min="1" required />
          </div>
          <div class="form-group">
            <label for="land-area" class="required">Área del Terreno (m²)</label>
            <input type="number" id="land-area" placeholder="Ej: 200" min="1" required />
          </div>
        </div>
        
        <div style="margin: var(--space-md) 0;">
          <button class="btn-primary" type="button" onclick="locateMeOnce()">
            <i class="fas fa-location-crosshairs"></i> Usar mi ubicación
          </button>
          <div class="form-help">Requiere HTTPS o localhost y permiso del navegador</div>
        </div>

        <div class="form-section-title"><i class="fas fa-map"></i> Ubicación en Mapa</div>
        <div id="gmap" style="height: 360px; border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border);"></div>
        <div class="form-help">Arrastre el pin para ajustar la posición o <strong>toque/cliquee en cualquier lugar del mapa</strong> para colocar el marcador</div>
      </div>

      <div class="form-section" data-step="2">
        <h2><i class="fas fa-home"></i> Características de la Propiedad</h2>
        
        <div class="form-section-title"><i class="fas fa-file-contract"></i> Datos Registrales</div>
        <div class="form-grid">
          <div class="form-group"><label for="owner-name">Nombre del Propietario</label><input type="text" id="owner-name" placeholder="Ingrese el nombre del propietario" /></div>
          <div class="form-group"><label for="deed-number">Número de Escritura</label><input type="text" id="deed-number" placeholder="Número de escritura" /></div>
          <div class="form-group"><label for="deed-date">Fecha de Escritura</label><input type="date" id="deed-date" /></div>
          <div class="form-group"><label for="notary">Notario</label><input type="text" id="notary" placeholder="Nombre del notario" /></div>
        </div>

        <div class="form-section-title"><i class="fas fa-map-marked-alt"></i> Finca Registrada</div>
        <div class="form-grid">
          <div class="form-group"><label for="finca">Finca</label><input type="text" id="finca" placeholder="Número de finca" /></div>
          <div class="form-group"><label for="folio">Folio</label><input type="text" id="folio" placeholder="Folio" /></div>
          <div class="form-group"><label for="libro">Libro</label><input type="text" id="libro" placeholder="Libro" /></div>
          <div class="form-group"><label for="department">Departamento</label><input type="text" id="department" placeholder="Departamento" /></div>
        </div>

        <div class="form-section-title" style="margin-top: var(--space-lg);"><i class="fas fa-map-marker-alt"></i> Colindancias</div>
        <table class="table-ui">
          <thead><tr><th>Dirección</th><th>Propietario</th><th>Metros</th></tr></thead>
          <tbody>
            <tr><td><strong>Norte:</strong></td><td><input type="text" id="norte-propietario" placeholder="Propietario" /></td><td><input type="number" id="norte-metros" placeholder="Metros" step="0.01" /></td></tr>
            <tr><td><strong>Sur:</strong></td><td><input type="text" id="sur-propietario" placeholder="Propietario" /></td><td><input type="number" id="sur-metros" placeholder="Metros" step="0.01" /></td></tr>
            <tr><td><strong>Oriente:</strong></td><td><input type="text" id="oriente-propietario" placeholder="Propietario" /></td><td><input type="number" id="oriente-metros" placeholder="Metros" step="0.01" /></td></tr>
            <tr><td><strong>Poniente:</strong></td><td><input type="text" id="poniente-propietario" placeholder="Propietario" /></td><td><input type="number" id="poniente-metros" placeholder="Metros" step="0.01" /></td></tr>
          </tbody>
        </table>

        <div class="form-section-title"><i class="fas fa-hammer"></i> Características Constructivas</div>
        <div class="characteristics-grid">
          <div class="form-group"><label for="uso-destino">Uso y Destino</label><select id="uso-destino"><option value="">Seleccionar</option><option value="residencia">Residencia</option><option value="cultivo">Cultivo</option><option value="industrial">Industrial</option><option value="comercial">Comercial</option><option value="edificio">Edificio</option></select></div>
          <div class="form-group"><label for="estructura">Estructura</label><select id="estructura"><option value="">Seleccionar</option><option value="acero">Acero</option><option value="hierro">Hierro</option><option value="concreto">Concreto</option><option value="madera">Madera</option><option value="pre-fab">Pre-Fab</option><option value="adobe">Adobe</option></select></div>
          <div class="form-group"><label for="cimiento">Cimiento</label><select id="cimiento"><option value="">Seleccionar</option><option value="concreto">Concreto</option><option value="adobe">Adobe</option><option value="block">Block</option><option value="ladrillo">Ladrillo</option><option value="piedra">Piedra</option><option value="otros">Otros</option></select></div>
          <div class="form-group"><label for="techos">Techos</label><select id="techos"><option value="">Seleccionar</option><option value="concreto">Concreto</option><option value="lam-zinc">Lam. Zinc</option><option value="dural-roja">Dural. Roja</option><option value="dural-gris">Dural. Gris</option><option value="teja-barro">Teja de barro</option><option value="otros">Otros</option></select></div>
          <div class="form-group"><label for="pisos">Pisos</label><select id="pisos"><option value="">Seleccionar</option><option value="tota-ceramico">Tota-Cerámico</option><option value="ceramico">Cerámico</option><option value="granito">Granito</option><option value="porcelanato">Porcelanato</option><option value="madera">Madera</option><option value="tierra">Tierra</option></select></div>
          <div class="form-group"><label for="acabados">Acabados Interiores</label><select id="acabados"><option value="">Seleccionar</option><option value="repello">Repello</option><option value="cernido">Cernido</option><option value="alisado">Alisado</option><option value="estuco">Estuco</option><option value="tapiz">Tapiz</option><option value="otro">Otro</option></select></div>
          <div class="form-group"><label for="paredes">Paredes</label><select id="paredes"><option value="">Seleccionar</option><option value="block">Block</option><option value="adobe">Adobe</option><option value="madera">Madera</option><option value="bahareque">Bahareque</option><option value="prefabricado">Prefabricado</option><option value="concreto">Concreto</option></select></div>
          <div class="form-group"><label for="ventanas">Ventanas</label><select id="ventanas"><option value="">Seleccionar</option><option value="upvc">UPVC</option><option value="aluminio">Aluminio</option><option value="metal">Metal</option><option value="madera">Madera</option><option value="otros">Otros</option></select></div>
          <div class="form-group"><label for="puertas">Puertas</label><select id="puertas"><option value="">Seleccionar</option><option value="upvc">UPVC</option><option value="madera">Madera</option><option value="metal">Metal</option><option value="pre-fab">Pre-Fab</option><option value="rustica">Rústica</option><option value="otros">Otros</option></select></div>
          <div class="form-group"><label for="cielos">Cielos</label><select id="cielos"><option value="">Seleccionar</option><option value="concreto">Concreto</option><option value="prefabricado">Prefabricado</option><option value="machimbre">Machimbre</option><option value="madera">Madera</option><option value="falsa-terraza">Falsa terraza</option><option value="sin-cielo">Sin Cielo</option><option value="otros">Otros</option></select></div>
          <div class="form-group"><label for="sanitario">Sanitario</label><select id="sanitario"><option value="">Seleccionar</option><option value="bueno">Bueno</option><option value="medio">Medio</option><option value="bajo">Bajo</option><option value="letrina">Letrina</option><option value="pozo">Pozo</option></select></div>
          <div class="form-group"><label for="red-electric">Red Eléctrica</label><select id="red-electric"><option value="">Seleccionar</option><option value="municipal">Municipal</option><option value="energuate">Energuate</option><option value="solar">Solar</option><option value="solar-fed">Solar/Fed</option><option value="sin-elec">Sin Electricidad</option></select></div>
          <div class="form-group"><label for="agua">Servicio de Agua</label><select id="agua"><option value="">Seleccionar</option><option value="municipal">Municipal</option><option value="comunal">Comunal</option><option value="pozo">Pozo</option><option value="otros">Otros</option></select></div>
          <div class="form-group"><label for="estado-inmueble">Estado de Conservación</label><select id="estado-inmueble"><option value="">Seleccionar</option><option value="Excelente">Excelente</option><option value="Bueno">Bueno</option><option value="Regular">Regular</option><option value="Malo">Malo</option></select></div>
          <div class="form-group"><label for="anio-construccion">Año de Construcción</label><input type="number" id="anio-construccion" min="1900" max="2025" placeholder="Ej: 2018" /></div>
        </div>

        <div class="form-group" style="margin-top:24px;">
          <label for="otros-detalles">Otros Detalles Específicos</label>
          <textarea id="otros-detalles" placeholder="Describa otros detalles como: Aire Acondicionado, Car-port, Garaje, Chimeneas, etc."></textarea>
        </div>

        <div class="form-section-title" style="margin-top: var(--space-lg);"><i class="fas fa-list"></i> Catalogo de categorías y tipologías</div>
        <div class="form-group">
          <label>Tipología constructiva</label>
          <div class="typology-selector" onclick="__openTypology()">
            <div id="typologyTrigger" class="typology-trigger">
              <img id="selectedImage" class="selected-image" src="https://images.unsplash.com/photo-1505691938895-1758d7feb511?auto=format&fit=crop&w=200&q=60" alt="Tipología" />
              <div class="selected-text">
                <div id="selectedType" class="selected-type">Catálogo</div>
                <div id="selectedTitle" class="selected-title">Pulsa para elegir del catálogo</div>
                <div id="selectedPrice" class="selected-price">—</div>
              </div>
            </div>
          </div>
          <input type="hidden" id="typology" value="">
          <div class="form-help">Toca el recuadro para abrir el catálogo de tipologías</div>
        </div>

        <!-- Sección para subir imágenes de evidencia -->
        <div class="form-section-title" style="margin-top: var(--space-lg);">
          <i class="fas fa-camera"></i> Evidencia Fotográfica del Inmueble
        </div>
        <div class="form-group">
          <label>Subir imágenes de evidencia</label>
          <div class="image-upload-container">
            <input type="file" id="image-upload" multiple accept="image/*" style="display: none;">
            <div class="upload-area" id="upload-area">
              <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--primary-light); margin-bottom: 12px;"></i>
              <div style="font-weight: 500; color: var(--text); margin-bottom: 8px;">Arrastra imágenes aquí o haz clic para seleccionar</div>
              <div style="font-size: 0.85rem; color: var(--text-light);">Formatos: JPG, PNG, GIF • Máx. 5MB por imagen</div>
              <button type="button" class="btn-secondary" onclick="document.getElementById('image-upload').click()" style="margin-top: 16px;">
                <i class="fas fa-folder-open"></i> Seleccionar Archivos
              </button>
            </div>
            <div id="image-preview" class="image-preview-container"></div>
          </div>
          <div class="form-help">Suba fotografías que sirvan como evidencia para el avalúo (fachada, interiores, detalles constructivos, etc.)</div>
        </div>
      </div>

      <div class="form-section" data-step="3">
        <h2><i class="fas fa-calculator"></i> Datos de propiedad</h2>
        
        <div class="form-section-title"><i class="fas fa-mountain"></i> Cálculo del Valor del Terreno</div>
        <table class="table-ui" id="tablaTerreno">
          <thead>
            <tr>
              <th style="width:140px">V/Base (Q/m²)</th>
              <th style="width:140px">Área m²</th>
              <th style="width:120px">Fac. Fte.</th>
              <th style="width:120px">Fac. Fdo.</th>
              <th style="width:120px">Fac. Fma.</th>
              <th style="width:120px">Fac. Ext.</th>
              <th style="width:140px">Otros Fac.</th>
              <th style="width:160px">MONTO</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="number" min="0" step="0.01" class="t-vbase" placeholder="1500"></td>
              <td><input type="number" min="0" step="0.01" class="t-area" id="t-area" placeholder="0"></td>
              <td><input type="number" min="0" step="0.01" class="t-ffte" placeholder="1" value="1"></td>
              <td><input type="number" min="0" step="0.01" class="t-ffdo" placeholder="1" value="1"></td>
              <td><input type="number" min="0" step="0.01" class="t-ffma" placeholder="1" value="1"></td>
              <td><input type="number" min="0" step="0.01" class="t-fext" placeholder="1" value="1"></td>
              <td><input type="number" min="0" step="0.01" class="t-fotros" placeholder="1" value="1"></td>
              <td><input type="text" class="t-monto" id="t-monto" value="0.00" readonly></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="7" style="text-align:right; font-weight:600;">TOTAL TERRENO</td>
              <td><input type="text" id="totalTerreno" value="0.00" readonly></td>
            </tr>
          </tfoot>
        </table>

        <div class="form-section-title"><i class="fas fa-building-user"></i> Cálculo del Valor de la Construcción</div>
        <table class="table-ui" id="tablaConstruccion">
          <thead>
            <tr>
              <th style="width:160px">Planta</th>
              <th style="width:140px">Área m²</th>
              <th style="width:140px">V/Base</th>
              <th style="width:120px">%</th>
              <th>Tipo de Construcción</th>
              <th style="width:160px">MONTO</th>
            </tr>
          </thead>
          <tbody id="tbBodyConstruccion">
            <tr>
              <td><input type="text" value="Primer Nivel" class="planta-input"></td>
              <td><input type="number" min="0" step="0.01" class="area-input" placeholder="0"></td>
              <td><input type="number" min="0" step="0.01" class="vbase-input" placeholder="0"></td>
              <td><input type="number" min="0" step="0.01" value="1" class="coef-input"></td>
              <td><input type="text" class="tipo-input" placeholder="Ej.: Block y Concreto"></td>
              <td><input type="text" class="monto-output" value="0.00" readonly></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="5" style="text-align:right; font-weight:600;">TOTAL</td>
              <td><input type="text" id="totalConstruccion" value="0.00" readonly></td>
            </tr>
          </tfoot>
        </table>

        <div style="display:flex; gap:12px; margin-top:8px;">
          <button class="btn-secondary btn-small" type="button" onclick="agregarFilaConstruccion()">
            <i class="fas fa-plus"></i> Agregar nivel
          </button>
          <button class="btn-secondary btn-small" type="button" onclick="eliminarUltimaFilaConstruccion()">
            <i class="fas fa-minus"></i> Quitar último nivel
          </button>
        </div>

        <div class="form-help" style="margin-top:8px;">
          El MONTO se calcula como: <strong>Área m² × V/Base × %</strong>. Todos los campos son manuales (editables), excepto MONTO.
        </div>

        <div class="form-section-title"><i class="fas fa-layer-group"></i> Integración de Valores</div>
        <div class="result-grid" id="integracionValores">
          <div class="result-item">
            <div class="label">Valor del Terreno</div>
            <div class="value" id="ivTerreno">Q0.00</div>
          </div>
          <div class="result-item">
            <div class="label">Valor de Construcción</div>
            <div class="value" id="ivConstruccion">Q0.00</div>
          </div>
          <div class="result-item">
            <div class="label">Total Avalúo</div>
            <div class="value" id="ivTotal">Q0.00</div>
          </div>
        </div>
      </div>

      <div class="form-navigation">
        <button class="btn-secondary" id="prev-step"><i class="fas fa-arrow-left"></i> Anterior</button>
        <button class="btn-primary" id="next-step">Siguiente <i class="fas fa-arrow-right"></i></button>
      </div>
    </div>

    <div class="result-section" id="resultSection">
      <div class="card">
        <h2><i class="fas fa-chart-bar"></i> Calculo final</h2>
        <div class="result-grid">
          <div class="result-item"><div class="label">Área Construida</div><div class="value" id="resultArea">0 m²</div></div>
          <div class="result-item"><div class="label">Tipología</div><div class="value" id="resultTypology">-</div></div>
          <div class="result-item"><div class="label">Estado</div><div class="value" id="resultCondition">-</div></div>
          <div class="result-item"><div class="label">Antigüedad</div><div class="value" id="resultAge">0 años</div></div>
          <div class="result-item"><div class="label">Valor Terreno (sin ajuste)</div><div class="value" id="resultLandValue">Q0.00</div></div>
          <div class="result-item"><div class="label">Avaluó Terreno (con ajuste)</div><div class="value" id="resultLandAppraisal">Q0.00</div></div>
          <div class="result-item"><div class="label">Valor Construcción</div><div class="value" id="resultBuildValue">Q0.00</div></div>
          <div class="result-item"><div class="label">TOTAL Terreno + Construcción</div><div class="value" id="resultGrandTotal">Q0.00</div></div>
        </div>
        <div class="result-total"><div class="label">VALOR TOTAL ESTIMADO</div><div class="value" id="resultTotal">Q0.00</div></div>
        <div style="display:flex; gap:12px; margin-top:24px;">
          <button class="btn-primary" onclick="generateReport()" style="flex:1;"><i class="fas fa-file-pdf"></i> Generar Reporte PDF</button>
          <button class="btn-secondary" onclick="newAppraisal()" style="flex:1;"><i class="fas fa-redo"></i> Nuevo Avalúo</button>
        </div>
      </div>
    </div>

    <div class="catalog-modal" id="catalogModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-home"></i> Seleccionar Tipología Constructiva</h3>
          <button class="modal-close" id="closeModal" type="button">&times;</button>
        </div>
        <div class="modal-body" style="padding: 0;">
          <!-- NUEVA ESTRUCTURA CON PESTAÑAS Y ACORDEONES -->
          <div class="typology-tabs">
            <button class="typology-tab active" data-tab="baja">Categoría Baja</button>
            <button class="typology-tab" data-tab="media">Categoría Media</button>
            <button class="typology-tab" data-tab="alta">Categoría Alta</button>
          </div>
          
          <div class="typology-tab-content active" id="tab-baja">
            <!-- Contenido se llena dinámicamente -->
          </div>
          
          <div class="typology-tab-content" id="tab-media">
            <!-- Contenido se llena dinámicamente -->
          </div>
          
          <div class="typology-tab-content" id="tab-alta">
            <!-- Contenido se llena dinámicamente -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div style="color: var(--primary); font-weight: 500;">Generando PDF...</div>
  </div>

  <button id="save-btn" type="button"><i class="fas fa-save"></i> Guardar</button>
  <button id="pdf-btn" type="button"><i class="fas fa-file-pdf"></i> PDF</button>

  <script>
    // FUNCIONES ORIGINALES MANTENIDAS
    function modificarPrecioTipologia(tipologiaId, nuevoPrecio) {
        const tipologias = __getTipos();
        const tipologia = tipologias.find(t => t.id === tipologiaId);
        
        if (!tipologia) {
            console.error('Tipología no encontrada:', tipologiaId);
            return false;
        }
        
        const rango = RANGOS_PRECIO[tipologia.category]?.[tipologia.type];
        
        if (!rango) {
            console.error('Rango de precios no encontrado para:', tipologia.category, tipologia.type);
            return false;
        }
        
        const precioMaximo = rango.max;
        
        if (nuevoPrecio > precioMaximo) {
            console.warn(`El precio no puede superar Q${precioMaximo}. Se establecerá en el máximo permitido.`);
            nuevoPrecio = precioMaximo;
        }
        
        if (nuevoPrecio < rango.min) {
            console.warn(`El precio no puede ser menor a Q${rango.min}. Se establecerá en el mínimo permitido.`);
            nuevoPrecio = rango.min;
        }
        
        tipologia.pricePerM2 = nuevoPrecio;
        
        const tipologiaActual = document.getElementById('typology').value;
        if (tipologiaActual === tipologiaId) {
            const precioInput = document.getElementById('precio-editable-input');
            if (precioInput) {
                precioInput.value = nuevoPrecio;
                
                const pr = document.getElementById('selectedPrice');
                if (pr) {
                    pr.textContent = `Q${nuevoPrecio.toLocaleString('es-GT')}/m²`;
                }
                
                if (document.getElementById('resultSection').classList.contains('active')) {
                    calculateRealAppraisal();
                }
            }
        }
        
        console.log(`Precio de ${tipologia.title} actualizado a: Q${nuevoPrecio}/m²`);
        return true;
    }

    // Storage functions manteniendo las originales
    window.avaluosStorage = {
      getAllAppraisals: function() {
        try {
          const stored = localStorage.getItem('sistema_avaluos');
          return stored ? JSON.parse(stored) : [];
        } catch (e) {
          console.error('Error al cargar avalúos:', e);
          return [];
        }
      },

      saveAppraisal: function(avaluoData) {
        try {
          const avaluos = this.getAllAppraisals();
          const newAppraisal = {
            id: 'av-' + Date.now(),
            usuario_id: window.__session?.user?.id || 'anonimo',
            usuario_nombre: window.__session?.user?.user_metadata?.username || 'Anónimo',
            fecha_creacion: new Date().toISOString(),
            fecha_formateada: new Date().toLocaleDateString('es-GT'),
            datos: avaluoData,
            estado: 'completado'
          };
          
          avaluos.unshift(newAppraisal);
          localStorage.setItem('sistema_avaluos', JSON.stringify(avaluos));
          return newAppraisal;
        } catch (e) {
          console.error('Error al guardar avalúo:', e);
          return null;
        }
      },

      getMyAppraisals: function() {
        const userId = window.__session?.user?.id;
        if (!userId) return [];
        
        const allAppraisals = this.getAllAppraisals();
        return allAppraisals.filter(av => av.usuario_id === userId);
      },

      updateAppraisal: function(appraisalId, newData) {
        try {
          const avaluos = this.getAllAppraisals();
          const index = avaluos.findIndex(av => av.id === appraisalId);
          
          if (index !== -1) {
            avaluos[index].datos = { ...avaluos[index].datos, ...newData };
            avaluos[index].fecha_actualizacion = new Date().toISOString();
            localStorage.setItem('sistema_avaluos', JSON.stringify(avaluos));
            return true;
          }
          return false;
        } catch (e) {
          console.error('Error al actualizar avalúo:', e);
          return false;
        }
      },

      deleteAppraisal: function(appraisalId) {
        try {
          const avaluos = this.getAllAppraisals();
          const filtered = avaluos.filter(av => av.id !== appraisalId);
          localStorage.setItem('sistema_avaluos', JSON.stringify(filtered));
          return true;
        } catch (e) {
          console.error('Error al eliminar avalúo:', e);
          return false;
        }
      }
    };

    // Funciones de modal manteniendo las originales
    function showAllAppraisals() {
      const modal = document.getElementById('all-appraisals-modal');
      const listContainer = document.getElementById('all-appraisals-list');
      
      const allAppraisals = window.avaluosStorage.getAllAppraisals();
      
      if (allAppraisals.length === 0) {
        listContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h4>No hay avalúos registrados</h4>
            <p>Los avalúos que se realicen aparecerán aquí</p>
          </div>
        `;
      } else {
        listContainer.innerHTML = allAppraisals.map(avaluo => `
          <div class="appraisal-item">
            <div class="appraisal-header">
              <div class="appraisal-date">
                <i class="fas fa-calendar"></i> ${avaluo.fecha_formateada}
              </div>
              <div class="appraisal-actions">
                <button class="btn-secondary btn-small" onclick="viewAppraisal('${avaluo.id}')">
                  <i class="fas fa-eye"></i> Ver
                </button>
              </div>
            </div>
            <div class="appraisal-details">
              <div><strong>Asociado:</strong> ${avaluo.datos.associateName || 'No especificado'}</div>
              <div><strong>Dirección:</strong> ${avaluo.datos.address || 'No especificado'}</div>
              <div><strong>Valor Total:</strong> ${avaluo.datos.totalValue || 'Q0.00'}</div>
              <div><strong>Usuario:</strong> ${avaluo.usuario_nombre}</div>
            </div>
          </div>
        `).join('');
      }
      
      modal.classList.add('active');
    }

    function showMyAppraisals() {
      if (!window.__session) {
        alert('Debes iniciar sesión para ver tus avalúos');
        document.getElementById('auth-overlay').style.display = 'flex';
        return;
      }
      
      const modal = document.getElementById('my-appraisals-modal');
      const listContainer = document.getElementById('my-appraisals-list');
      
      const myAppraisals = window.avaluosStorage.getMyAppraisals();
      
      if (myAppraisals.length === 0) {
        listContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-file-contract"></i>
            <h4>No tienes avalúos guardados</h4>
            <p>Los avalúos que realices aparecerán aquí</p>
          </div>
        `;
      } else {
        listContainer.innerHTML = myAppraisals.map(avaluo => `
          <div class="appraisal-item">
            <div class="appraisal-header">
              <div class="appraisal-date">
                <i class="fas fa-calendar"></i> ${avaluo.fecha_formateada}
              </div>
              <div class="appraisal-actions">
                <button class="btn-primary btn-small" onclick="editAppraisal('${avaluo.id}')">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button class="btn-secondary btn-small" onclick="viewAppraisal('${avaluo.id}')">
                  <i class="fas fa-eye"></i> Ver
                </button>
                <button class="btn-small" style="background: var(--error); color: white; border: none;" onclick="deleteAppraisal('${avaluo.id}')">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="appraisal-details">
              <div><strong>Asociado:</strong> ${avaluo.datos.associateName || 'No especificado'}</div>
              <div><strong>Dirección:</strong> ${avaluo.datos.address || 'No especificado'}</div>
              <div><strong>Valor Total:</strong> ${avaluo.datos.totalValue || 'Q0.00'}</div>
              <div><strong>Estado:</strong> <span style="color: var(--success);">${avaluo.estado}</span></div>
            </div>
          </div>
        `).join('');
      }
      
      modal.classList.add('active');
    }

    function viewAppraisal(appraisalId) {
      const avaluos = window.avaluosStorage.getAllAppraisals();
      const avaluo = avaluos.find(av => av.id === appraisalId);
      
      if (avaluo) {
        alert(`Detalles del Avalúo:\n\n` +
              `Fecha: ${avaluo.fecha_formateada}\n` +
              `Asociado: ${avaluo.datos.associateName || 'No especificado'}\n` +
              `Dirección: ${avaluo.datos.address || 'No especificado'}\n` +
              `Área Construida: ${avaluo.datos.constructionArea || '0'} m²\n` +
              `Valor Total: ${avaluo.datos.totalValue || 'Q0.00'}\n` +
              `Usuario: ${avaluo.usuario_nombre}`);
      }
    }

    function editAppraisal(appraisalId) {
      const avaluos = window.avaluosStorage.getAllAppraisals();
      const avaluo = avaluos.find(av => av.id === appraisalId);
      
      if (avaluo) {
        document.getElementById('associate-name').value = avaluo.datos.associateName || '';
        document.getElementById('address').value = avaluo.datos.address || '';
        document.getElementById('construction-area').value = avaluo.datos.constructionArea || '';
        document.getElementById('land-area').value = avaluo.datos.landArea || '';
        
        closeModal('my-appraisals-modal');
        window.formWizard.goToStep(1);
        
        alert('Avalúo cargado para edición. Modifica los datos y guarda los cambios.');
      }
    }

    function deleteAppraisal(appraisalId) {
      if (confirm('¿Estás seguro de que quieres eliminar este avalúo? Esta acción no se puede deshacer.')) {
        if (window.avaluosStorage.deleteAppraisal(appraisalId)) {
          alert('Avalúo eliminado correctamente');
          showMyAppraisals();
        } else {
          alert('Error al eliminar el avalúo');
        }
      }
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    async function saveCurrentAppraisal() {
      if (!window.__session) {
        alert('Debes iniciar sesión para guardar avalúos');
        return false;
      }
      
      console.log('🟡 Iniciando guardado en ambos sistemas...');
      
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) loadingOverlay.style.display = 'flex';
      
      try {
        const appraisalData = {
          associateName: document.getElementById('associate-name').value || 'No especificado',
          address: document.getElementById('address').value || 'No especificado',
          constructionArea: parseFloat(document.getElementById('construction-area').value) || 0,
          landArea: parseFloat(document.getElementById('land-area').value) || 0,
          totalValue: document.getElementById('resultTotal').textContent || 'Q0.00',
          ownerName: document.getElementById('owner-name').value || '',
          typology: document.getElementById('typology').value || '',
          department: document.getElementById('department').value || '',
          estadoInmueble: document.getElementById('estado-inmueble').value || '',
          anioConstruccion: document.getElementById('anio-construccion').value || '',
          totalConstruccion: document.getElementById('totalConstruccion').value || '0',
          totalTerreno: document.getElementById('totalTerreno').value || '0'
        };

        console.log('📦 Datos a guardar:', appraisalData);

        const savedInLocal = window.avaluosStorage.saveAppraisal(appraisalData);
        console.log('✅ Guardado en localStorage:', savedInLocal);

        console.log('🔄 Enviando a Supabase...');
        
        const { data, error } = await window.supabase
          .from('avaluos')
          .insert([
            {
              usuario_id: window.__session.user.id,
              usuario_email: window.__session.user.email,
              usuario_nombre: window.__session.user.user_metadata?.username || 'Usuario',
              fecha_creacion: new Date().toISOString(),
              fecha_formateada: new Date().toLocaleDateString('es-GT'),
              associate_name: appraisalData.associateName,
              address: appraisalData.address,
              construction_area: appraisalData.constructionArea,
              land_area: appraisalData.landArea,
              total_value: appraisalData.totalValue,
              owner_name: appraisalData.ownerName,
              typology: appraisalData.typology,
              department: appraisalData.department,
              estado_inmueble: appraisalData.estadoInmueble,
              anio_construccion: appraisalData.anioConstruccion,
              total_construccion: appraisalData.totalConstruccion,
              total_terreno: appraisalData.totalTerreno,
              datos_completos: appraisalData
            }
          ])
          .select();

        if (error) {
          console.error('❌ Error Supabase:', error);
          console.warn('Avalúo guardado en web pero no en base de datos');
        } else {
          console.log('✅ Éxito - Datos guardados en Supabase:', data);
        }

        alert('✅ Avalúo guardado EXITOSAMENTE\n\n• En la web: Disponible en "Lista de Avalúos"\n• En base de datos: Para tu seguimiento');
        
        if (document.getElementById('all-appraisals-modal').classList.contains('active')) {
          showAllAppraisals();
        }
        if (document.getElementById('my-appraisals-modal').classList.contains('active')) {
          showMyAppraisals();
        }
        
        return true;
        
      } catch (error) {
        console.error('❌ Error completo al guardar:', error);
        alert('❌ Error al guardar: ' + error.message + '\n\nEl avalúo se guardó en la web pero no en la base de datos.');
        return false;
      } finally {
        if (loadingOverlay) loadingOverlay.style.display = 'none';
      }
    }

    document.getElementById('all-appraisals-btn').addEventListener('click', showAllAppraisals);
    document.getElementById('my-appraisals-btn').addEventListener('click', showMyAppraisals);

    document.getElementById('all-appraisals-modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal('all-appraisals-modal');
    });
    document.getElementById('my-appraisals-modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal('my-appraisals-modal');
    });

    // NUEVAS TIPOLOGÍAS COMPLETAS ORGANIZADAS EN EL ORDEN EXACTO
    const RANGOS_PRECIO = {
        'Baja': {
            'Baja': { min: 250, max: 500 },
            'Media': { min: 650, max: 850 },
            'Alta': { min: 850, max: 1000 }
        },
        'Media': {
            'Baja': { min: 800, max: 1100 },
            'Media': { min: 900, max: 1300 },
            'Alta': { min: 1300, max: 1800 }
        },
        'Alta': {
            'Baja': { min: 1400, max: 1800 },
            'Media': { min: 1800, max: 2200 },
            'Alta': { min: 2300, max: 2900 }
        }
    };

    const __FALLBACK_TIPOLOGIAS = [
      // =============================================
      // CATEGORÍA BAJA - TIPOLOGÍA BAJA
      // =============================================
      {
        id: "baja-baja-1",
        category: "Baja",
        type: "Baja",
        title: "Tipología Baja - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/tipolog%C3%ADa%20baja.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/interior%20tipolog%C3%ADa%20baja.png",
        pricePerM2: 400,
        description: "CATEGORÍA BAJA - TIPOLOGÍA BAJA: Como sistema constructivo encontramos estructura de madera, muro de block o adobe de 1.00 metro de alto con estructura de madera",
        bullets: [
          "Estructura: sistema de adobe, madera",
          "Paredes: adobe recubierto con nylon",
          "Techos: teja de barro sin cielo falso",
          "Piso: tierra con cemento",
          "Ventanas: madera sin tratar",
          "Puertas: madera sin tratar",
          "Servicios: luz, alumbrado público",
          "Exterior: fachada con material expuesto",
          "Instalaciones: expuestas"
        ],
        sistemasConstructivos: [
          "Estructura de madera",
          "Muro de block o adobe de 1.00 metro de alto con estructura de madera"
        ],
        recubrimientos: [
          "Adobe",
          "Block de cantera sin norma de construcción",
          "Madera sin tratar"
        ],
        acabados: [
          "Block sisado visto",
          "Adobe visto",
          "Madera sin tratar",
          "Blanqueado con cal hidratada"
        ],
        cubiertas: [
          "Estructura de madera con cubierta de lámina de zinc",
          "Estructura de costaneras de metal con cubierta de lámina de zinc",
          "Estructura de madera cubierta con teja de barro"
        ],
        pisos: [
          "Tierra",
          "Cemento líquido"
        ],
        puertasVentanas: [
          "Madera sencilla sin tratamiento",
          "Cortinas o cedazo",
          "Sin puertas o ventanas"
        ],
        diseno: [
          "Casas diseñadas en un solo ambiente",
          "Casas diseñadas en dos ambientes",
          "Baño en el exterior de la vivienda (letrina o pozo ciego)"
        ],
        servicios: [
          "Agua potable",
          "Energía eléctrica"
        ],
        acceso: [
          "Terracería (vehicular o vecinal)"
        ]
      },
      {
        id: "baja-baja-2",
        category: "Baja",
        type: "Baja",
        title: "Tipología Baja - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/tipolog%C3%ADa%20baja%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/interior%20tipolog%C3%ADa%20baja%202.png",
        pricePerM2: 500,
        description: "CATEGORÍA BAJA - TIPOLOGÍA BAJA: Como sistema constructivo encontramos estructura de adobe, columnas de madera",
        bullets: [
          "Estructura: sistema de adobe, columnas de madera",
          "Paredes: adobe, madera sin tratar, cartón",
          "Techos: teja de barro, lámina de zinc sin cielo falso",
          "Piso: tierra con cemento",
          "Ventanas: madera sin tratar",
          "Puertas: madera sin tratar",
          "Servicios: luz, alumbrado público",
          "Exterior: fachada sin mantenimiento",
          "Instalaciones: expuestas"
        ],
        sistemasConstructivos: [
          "Estructura de madera",
          "Muro de block o adobe de 1.00 metro de alto, resto estructura de madera"
        ],
        recubrimientos: [
          "Adobe",
          "Block de cantera sin norma de construcción"
        ],
        acabados: [
          "Block sisado visto",
          "Adobe visto",
          "Madera sin tratar",
          "Blanqueado con cal hidratada"
        ],
        cubiertas: [
          "Estructura de madera con cubierta de lámina de zinc",
          "Estructura de costaneras de metal con cubierta de lámina de zinc",
          "Estructura de madera cubierta con teja de barro"
        ],
        pisos: [
          "Tierra",
          "Cemento líquido"
        ],
        puertasVentanas: [
          "Madera sin tratar",
          "Metal",
          "Prefabricadas en MDF"
        ],
        diseno: [
          "Casas diseñadas en dos ambientes",
          "Casas diseñadas en tres ambientes",
          "Baño en el exterior de la vivienda (letrina o pozo ciego)"
        ],
        servicios: [
          "Agua potable",
          "Energía eléctrica",
          "Alumbrado público"
        ],
        acceso: [
          "Terracería (vehicular o vecinal)",
          "Adoquín",
          "Carrileras de concreto (vehicular o vecinal)"
        ]
      },

      // =============================================
      // CATEGORÍA BAJA - TIPOLOGÍA MEDIA
      // =============================================
      {
        id: "baja-media-1",
        category: "Baja",
        type: "Media",
        title: "Tipología Media - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/tipolog%C3%ADa%20media.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/interior%20tipolog%C3%ADa%20media.png",
        pricePerM2: 750,
        description: "CATEGORÍA BAJA - TIPOLOGÍA MEDIA: Como sistema constructivo encontramos sistema de adobe, block con pines fundidos",
        bullets: [
          "Estructura: sistema de adobe, block con pines fundidos",
          "Paredes: adobe con repello",
          "Techos: lámina de zinc con cielo falso de machimbre",
          "Piso: torta de cemento líquido, cerámico",
          "Ventanas: madera sin tratar",
          "Puertas: madera sin tratar",
          "Servicios: agua, luz, alumbrado público",
          "Exterior: fachada tipo corredor",
          "Instalaciones: expuestas"
        ],
        sistemasConstructivos: [
          "Estructura de madera",
          "Muro de block o adobe de 1.00 metro de alto, resto estructura de madera",
          "Mampostería con sistema pinedo",
          "Mampostería con columnas para un nivel"
        ],
        recubrimientos: [
          "Adobe",
          "Block de cantera sin norma de construcción"
        ],
        acabados: [
          "Block sisado visto",
          "Adobe visto",
          "Madera sin tratar",
          "Blanqueado con cal hidratada"
        ],
        cubiertas: [
          "Estructura de madera con cubierta de lámina de zinc",
          "Estructura de costaneras de metal con cubierta de lámina de zinc",
          "Estructura de madera cubierta con teja de barro",
          "Losa de concreto armado"
        ],
        pisos: [
          "Tierra",
          "Cemento líquido",
          "Granito"
        ],
        puertasVentanas: [
          "Madera sin tratar",
          "Metal",
          "Prefabricadas en MDF"
        ],
        diseno: [
          "Casas diseñadas en dos ambientes",
          "Casas diseñadas en tres ambientes",
          "Baño en el exterior de la vivienda (letrina o pozo ciego)"
        ],
        servicios: [
          "Agua potable",
          "Energía eléctrica",
          "Alumbrado público"
        ],
        acceso: [
          "Terracería (vehicular o vecinal)",
          "Adoquín",
          "Carrileras de concreto (vehicular o vecinal)"
        ]
      },
      {
        id: "baja-media-2",
        category: "Baja",
        type: "Media",
        title: "Tipología Media - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/tipolog%C3%ADa%20media%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/interior%20tipolog%C3%ADa%20media%202.png",
        pricePerM2: 850,
        description: "CATEGORÍA BAJA - TIPOLOGÍA MEDIA: Como sistema constructivo encontramos mampostería con columnas",
        bullets: [
          "Estructura: mampostería con columnas",
          "Paredes: block de cantera",
          "Techos: lámina de zinc",
          "Piso: torta de cemento líquido",
          "Ventanas: madera sin tratar",
          "Puertas: metal y madera sin tratar",
          "Servicios: agua, luz, drenajes",
          "Exterior: fachada sin ventanas ni diseño",
          "Instalaciones: expuestas"
        ],
        sistemasConstructivos: [
          "Mampostería con columnas para un nivel"
        ],
        recubrimientos: [
          "Block de cantera"
        ],
        acabados: [
          "Block sisado visto"
        ],
        cubiertas: [
          "Lámina de zinc"
        ],
        pisos: [
          "Cemento líquido"
        ],
        puertasVentanas: [
          "Madera sin tratar",
          "Metal"
        ],
        diseno: [
          "Fachada sin diseño arquitectónico"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes"
        ],
        acceso: [
          "Terracería"
        ]
      },

      // =============================================
      // CATEGORÍA BAJA - TIPOLOGÍA ALTA
      // =============================================
      {
        id: "baja-alta-1",
        category: "Baja",
        type: "Alta",
        title: "Tipología Alta - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/tipolog%C3%ADa%20alta.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/interior%20tipolog%C3%ADa%20alta.png",
        pricePerM2: 950,
        description: "CATEGORÍA BAJA - TIPOLOGÍA ALTA: Como sistema constructivo encontramos mampostería con pines fundidos a 0.60 metros",
        bullets: [
          "Estructura: mampostería con pines fundidos a 0.60 metros",
          "Paredes: block de cantera con pintura",
          "Techos: lámina troquelada",
          "Piso: torta de cemento líquido",
          "Ventanas: metal, madera sin tratar",
          "Puertas: metal, madera sin tratar",
          "Servicios: agua, luz, drenajes",
          "Exterior: fachada a dos aguas",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Estructura de madera",
          "Mampostería con sistema estructural pineado a cada 0.60 metros",
          "Mampostería con columnas para un nivel",
          "Mampostería con columnas para dos niveles (sin diseño estructural específico)"
        ],
        recubrimientos: [
          "Adobe",
          "Block normado estructuralmente para la construcción",
          "Block de cantera sin norma de construcción"
        ],
        acabados: [
          "Block sisado visto",
          "Blanqueado con cal hidratada",
          "Pintura sobre el block visto",
          "Capa delgada de repello y cernido"
        ],
        cubiertas: [
          "Estructura de madera con cubierta de lámina de zinc",
          "Estructura de costaneras de metal con cubierta de lámina de zinc",
          "Estructura de madera cubierta con teja de barro",
          "Losa de concreto armado"
        ],
        cielosFalsos: [
          "Machimbré",
          "Plywood"
        ],
        pisos: [
          "Granito",
          "Cemento líquido",
          "Cerámico"
        ],
        puertasVentanas: [
          "Madera sin tratar",
          "Metal",
          "uPVC"
        ],
        diseno: [
          "Casas diseñadas en tres ambientes",
          "Casas diseñadas en cuatro ambientes",
          "Baño simples en interior de la vivienda"
        ],
        servicios: [
          "Agua potable",
          "Energía eléctrica",
          "Alumbrado público",
          "Drenaje"
        ],
        acceso: [
          "Terracería",
          "Adoquín",
          "Carrileras de concreto",
          "Pavimento de concreto"
        ]
      },
      {
        id: "baja-alta-2",
        category: "Baja",
        type: "Alta",
        title: "Tipología Alta - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/tipolog%C3%ADa%20alta%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20baja/interior%20tipolog%C3%ADa%20alta.png",
        pricePerM2: 1000,
        description: "CATEGORÍA BAJA - TIPOLOGÍA ALTA: Como sistema constructivo encontramos sistema de adobe, mampostería reforzada",
        bullets: [
          "Estructura: sistema de adobe, mampostería reforzada",
          "Paredes: adobe con repello y cernido, block normado",
          "Techos: teja de barro, lámina de zinc, cielo falso de madera",
          "Piso: torta de cemento líquido, granito",
          "Ventanas: madera sin tratar, metal, uPVC",
          "Puertas: madera sin tratar, metal",
          "Servicios: agua, luz, drenajes",
          "Exterior: fachada tipo corredor",
          "Instalaciones: ocultas, expuestas"
        ],
        sistemasConstructivos: [
          "Sistema de adobe",
          "Mampostería reforzada"
        ],
        recubrimientos: [
          "Adobe",
          "Block normado estructuralmente para la construcción"
        ],
        acabados: [
          "Repello y cernido"
        ],
        cubiertas: [
          "Teja de barro",
          "Lámina de zinc"
        ],
        cielosFalsos: [
          "Madera"
        ],
        pisos: [
          "Cemento líquido",
          "Granito"
        ],
        puertasVentanas: [
          "Madera sin tratar",
          "Metal",
          "uPVC"
        ],
        diseno: [
          "Fachada tipo corredor"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes"
        ],
        acceso: [
          "Terracería",
          "Adoquín"
        ]
      },

      // =============================================
      // CATEGORÍA MEDIA - TIPOLOGÍA BAJA
      // =============================================
      {
        id: "media-baja-1",
        category: "Media",
        type: "Baja",
        title: "Tipología Baja - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/tipolog%C3%ADa%20baja.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/interior%20tipolog%C3%ADa%20baja.png",
        pricePerM2: 1100,
        description: "CATEGORÍA MEDIA - TIPOLOGÍA BAJA: Como sistema constructivo encontramos mampostería con block con pines fundidos",
        bullets: [
          "Estructura: mampostería con block con pines fundidos",
          "Paredes: block con repello y cernido",
          "Techo: lámina de zinc sin cielo falso",
          "Piso: torta de cemento líquido",
          "Ventanas: madera tratada",
          "Puertas: madera tratada, metal",
          "Servicios: agua, luz, drenajes",
          "Exterior: fachada tipo corredor",
          "Instalaciones: sobrepuestas"
        ],
        sistemasConstructivos: [
          "Sistema de mampostería reforzada",
          "Sistema de block pineado a cada 60 centímetros",
          "Algunas reforzadas para segundo nivel"
        ],
        recubrimientos: [
          "Block de cantera fabricado sin norma",
          "Block normado"
        ],
        acabados: [
          "Block sisado visto",
          "Pintura o blanqueado",
          "Repello y cernido con capa delgada"
        ],
        cubiertas: [
          "Techo de losa de concreto",
          "Estructura de metal cubierta con lámina de zinc o lámina troquelada",
          "Estructura de madera cubierta con lámina de zinc"
        ],
        pisos: [
          "Cerámico",
          "Granito"
        ],
        puertasVentanas: [
          "Madera",
          "Metal",
          "Prefabricados",
          "Aluminio"
        ],
        diseno: [
          "Casas sin presencia de diseño arquitectónico",
          "Casas con jardín o patio",
          "Casas con el baño dentro de la vivienda"
        ],
        servicios: [
          "Agua potable",
          "Energía eléctrica",
          "Drenajes"
        ],
        acceso: [
          "Adoquín",
          "Pavimento",
          "Asfalto"
        ]
      },
      {
        id: "media-baja-2",
        category: "Media",
        type: "Baja",
        title: "Tipología Baja - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/tipolog%C3%ADa%20baja%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/interior%20tipolog%C3%ADa%20baja%202.png",
        pricePerM2: 1100,
        description: "CATEGORÍA MEDIA - TIPOLOGÍA BAJA: Como sistema constructivo encontramos mampostería con columnas para un nivel",
        bullets: [
          "Estructura: mampostería con columnas para un nivel",
          "Paredes: block sisado visto, partes con repello y pintura",
          "Techo: tejas de barro, lámina de zinc con cielo falso de madera",
          "Piso: torta de cemento líquido",
          "Ventanas: metal, madera tratada",
          "Puertas: metal, madera tratada",
          "Servicios: agua, luz, drenajes",
          "Exterior: fachada sin diseño arquitectónico",
          "Instalaciones: sobrepuestas"
        ],
        sistemasConstructivos: [
          "Mampostería con columnas para un nivel"
        ],
        recubrimientos: [
          "Block sisado visto"
        ],
        acabados: [
          "Repello y pintura parcial"
        ],
        cubiertas: [
          "Tejas de barro",
          "Lámina de zinc"
        ],
        cielosFalsos: [
          "Madera"
        ],
        pisos: [
          "Cemento líquido"
        ],
        puertasVentanas: [
          "Metal",
          "Madera tratada"
        ],
        diseno: [
          "Fachada sin diseño arquitectónico"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },

      // =============================================
      // CATEGORÍA MEDIA - TIPOLOGÍA MEDIA
      // =============================================
      {
        id: "media-media-1",
        category: "Media",
        type: "Media",
        title: "Tipología Media - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/tipolog%C3%ADa%20media.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/interior%20tipolog%C3%ADa%20media.png",
        pricePerM2: 1200,
        description: "CATEGORÍA MEDIA - TIPOLOGÍA MEDIA: Como sistema constructivo encontramos mampostería reforzada para un nivel",
        bullets: [
          "Estructura: mampostería reforzada para un nivel",
          "Paredes: block con repello y cernido",
          "Techo: estructura de metal con lámina troquelada",
          "Piso: torta de cemento líquido",
          "Ventanas: metal",
          "Puertas: metal",
          "Servicios: agua, luz, drenajes",
          "Exterior: fachada tipo corredor interno",
          "Instalaciones: sobrepuestas o semi ocultas"
        ],
        sistemasConstructivos: [
          "Mampostería reforzada para un nivel"
        ],
        recubrimientos: [
          "Block con repello y cernido"
        ],
        cubiertas: [
          "Estructura de metal con lámina troquelada"
        ],
        pisos: [
          "Cemento líquido"
        ],
        puertasVentanas: [
          "Metal"
        ],
        diseno: [
          "Fachada tipo corredor interno"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },
      {
        id: "media-media-2",
        category: "Media",
        type: "Media",
        title: "Tipología Media - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/tipolog%C3%ADa%20media%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/interior%20tipolog%C3%ADa%20media%202.png",
        pricePerM2: 1300,
        description: "CATEGORÍA MEDIA - TIPOLOGÍA MEDIA: Como sistema constructivo encontramos mampostería reforzada para un nivel",
        bullets: [
          "Estructura: mampostería reforzada para un nivel",
          "Paredes: block normado con repello y cernido, pintura",
          "Techo: madera con lámina de zinc sin cielo falso",
          "Piso: granito, torta de cemento líquido",
          "Ventanas: metal con balcones",
          "Puertas: metal",
          "Servicios: agua, luz, drenajes, cable de TV",
          "Exterior: fachada tradicional sin diseño arquitectónico",
          "Instalaciones: ocultas, semi-ocultas"
        ],
        sistemasConstructivos: [
          "Mampostería reforzada para un nivel"
        ],
        recubrimientos: [
          "Block normado con repello y cernido, pintura"
        ],
        cubiertas: [
          "Madera con lámina de zinc"
        ],
        pisos: [
          "Granito",
          "Cemento líquido"
        ],
        puertasVentanas: [
          "Metal con balcones"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes",
          "Cable de TV"
        ],
        diseno: [
          "Fachada tradicional sin diseño arquitectónico"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },

      // =============================================
      // CATEGORÍA MEDIA - TIPOLOGÍA ALTA
      // =============================================
      {
        id: "media-alta-1",
        category: "Media",
        type: "Alta",
        title: "Tipología Alta - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/tipolog%C3%ADa%20alta.png",
        imgInterior: "https://github.com/Senseifizz7/Calcula-Aval-os/blob/main/categoria%20media/interior%20tipolog%C3%ADa%20alta.png",
        pricePerM2: 1700,
        description: "CATEGORÍA MEDIA - TIPOLOGÍA ALTA: Como sistema constructivo encontramos mampostería reforzada con columnas para 2 niveles",
        bullets: [
          "Estructura: mampostería reforzada con columnas para 2 niveles",
          "Paredes: ladrillo sisado visto, pintura",
          "Techo: losa de concreto armado",
          "Piso: granito",
          "Ventanas: metal, madera tratada",
          "Puertas: madera tratada, metal",
          "Servicios: agua, luz, drenajes, cable de TV",
          "Exterior: fachada típica de casas de ladrillo",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Sistema de mampostería reforzada",
          "Sistema de combinación de columnas con vigas de carga",
          "Algunas reforzadas para segundo nivel"
        ],
        recubrimientos: [
          "Ladrillo sisado visto"
        ],
        acabados: [
          "Pintura"
        ],
        cubiertas: [
          "Losa de concreto armado"
        ],
        pisos: [
          "Granito"
        ],
        puertasVentanas: [
          "Metal",
          "Madera tratada"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes",
          "Cable de TV"
        ],
        diseno: [
          "Fachada típica de casas de ladrillo"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },
      {
        id: "media-alta-2",
        category: "Media",
        type: "Alta",
        title: "Tipología Alta - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/tipolog%C3%ADa%20alta%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20media/interior%20tipolog%C3%ADa%20alta%202.png",
        pricePerM2: 1800,
        description: "CATEGORÍA MEDIA - TIPOLOGÍA ALTA: Como sistema constructivo encontramos mampostería reforzada con pines para un nivel",
        bullets: [
          "Estructura: mampostería reforzada con pines para un nivel",
          "Paredes: block normado con repello, alisado, pintura",
          "Techo: costaneras de metal con lámina de zinc, sin cielo falso",
          "Piso: cerámico",
          "Ventanas: metal con balcones",
          "Puertas: metal y madera tratada",
          "Servicios: luz, agua, drenaje, cable de TV",
          "Exterior: fachada con diseño tipo colonial",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Mampostería reforzada con pines para un nivel"
        ],
        recubrimientos: [
          "Block normado con repello, alisado, pintura"
        ],
        cubiertas: [
          "Costaneras de metal con lámina de zinc"
        ],
        pisos: [
          "Cerámico"
        ],
        puertasVentanas: [
          "Metal con balcones",
          "Madera tratada"
        ],
        servicios: [
          "Luz",
          "Agua",
          "Drenaje",
          "Cable de TV"
        ],
        diseno: [
          "Fachada con diseño tipo colonial"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },

      // =============================================
      // CATEGORÍA ALTA - TIPOLOGÍA BAJA
      // =============================================
      {
        id: "alta-baja-1",
        category: "Alta",
        type: "Baja",
        title: "Tipología Baja - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/tipolog%C3%ADa%20baja.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/interior%20tipolog%C3%ADa%20baja.png",
        pricePerM2: 1700,
        description: "CATEGORÍA ALTA - TIPOLOGÍA BAJA: Como sistema constructivo encontramos columnas y paredes de carga",
        bullets: [
          "Estructura: columnas y paredes de carga",
          "Paredes: repello, alisado, pintura",
          "Techo: losa de concreto o losa prefabricada",
          "Piso: cerámico, granito o porcelanato",
          "Ventanas: ventanas de aluminio o PVC",
          "Puertas: madera, metal y prefabricadas",
          "Servicios: agua, luz, drenajes, cable de TV",
          "Exterior: fachada tipo corredor, pintura",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Sistema de mampostería reforzada",
          "Combinación de columnas-vigas con sistema de muros de carga",
          "Columnas de concreto reforzado"
        ],
        recubrimientos: [
          "Block de cantera fabricado sin norma",
          "Block normado"
        ],
        acabados: [
          "Repello, alisado, pintura"
        ],
        cubiertas: [
          "Losa de concreto",
          "Lámina en algunas áreas o segundo nivel"
        ],
        pisos: [
          "Cerámico",
          "Granito",
          "Porcelanato",
          "Laminados"
        ],
        puertasVentanas: [
          "Madera",
          "Metal",
          "Prefabricadas",
          "Aluminio",
          "uPVC"
        ],
        diseno: [
          "Casas con un estudio en su diseño arquitectónico",
          "Casas con jardín o patio",
          "Casas con el baño dentro de la vivienda"
        ],
        servicios: [
          "Agua potable",
          "Energía eléctrica",
          "Drenajes",
          "Teléfono",
          "Internet",
          "Cable de TV"
        ],
        acceso: [
          "Adoquín",
          "Pavimento",
          "Asfalto"
        ]
      },
      {
        id: "alta-baja-2",
        category: "Alta",
        type: "Baja",
        title: "Tipología Baja - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/tipologia%20baja%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/interior%20tipologia%20baja%202.png",
        pricePerM2: 1800,
        description: "CATEGORÍA ALTA - TIPOLOGÍA BAJA: Como sistema constructivo encontramos columnas y paredes de carga",
        bullets: [
          "Estructura: columnas y paredes de carga",
          "Paredes: repello, alisado, pintura",
          "Techo: losa de concreto o losa prefabricada",
          "Piso: cerámico, granito o porcelanato",
          "Ventanas: ventanas de aluminio o PVC",
          "Puertas: madera, metal y prefabricadas",
          "Exterior: fachada con acabados y pintura",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Columnas y paredes de carga"
        ],
        acabados: [
          "Repello, alisado, pintura"
        ],
        cubiertas: [
          "Losa de concreto o losa prefabricada"
        ],
        pisos: [
          "Cerámico, granito o porcelanato"
        ],
        puertasVentanas: [
          "Aluminio o PVC",
          "Madera, metal y prefabricadas"
        ],
        diseno: [
          "Fachada con acabados y pintura"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },

      // =============================================
      // CATEGORÍA ALTA - TIPOLOGÍA MEDIA
      // =============================================
      {
        id: "alta-media-1",
        category: "Alta",
        type: "Media",
        title: "Tipología Media - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/tipolog%C3%ADa%20media.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/interior%20tipologia%20media.png",
        pricePerM2: 2100,
        description: "CATEGORÍA ALTA - TIPOLOGÍA MEDIA: Como sistema constructivo encontramos mampostería reforzada con columnas para dos niveles",
        bullets: [
          "Estructura: mampostería reforzada con columnas para dos niveles",
          "Paredes: block normado con repello, alisado, pintura",
          "Techo: losa de concreto, losa prefabricada",
          "Piso: cerámico, granito, porcelanato",
          "Ventanas: aluminio, uPVC",
          "Puertas: madera tratada, metal, prefabricadas",
          "Servicios: agua, luz, drenajes, cable de TV, internet",
          "Exterior: fachada con detalles arquitectónicos",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Sistema de mampostería reforzada",
          "Combinación de columnas-vigas con sistema de muros de carga",
          "Columnas de concreto reforzado"
        ],
        recubrimientos: [
          "Block normado con repello, alisado, pintura"
        ],
        cubiertas: [
          "Losa de concreto",
          "Losa prefabricada"
        ],
        pisos: [
          "Cerámico",
          "Granito",
          "Porcelanato"
        ],
        puertasVentanas: [
          "Aluminio",
          "uPVC",
          "Madera tratada",
          "Metal",
          "Prefabricadas"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes",
          "Cable de TV",
          "Internet"
        ],
        diseno: [
          "Fachada con detalles arquitectónicos"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },
      {
        id: "alta-media-2",
        category: "Alta",
        type: "Media",
        title: "Tipología Media - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/tipologia%20media%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/interior%20tipologia%20media%202.png",
        pricePerM2: 2200,
        description: "CATEGORÍA ALTA - TIPOLOGÍA MEDIA: Como sistema constructivo encontramos mampostería reforzada con columnas para dos niveles",
        bullets: [
          "Estructura: mampostería reforzada con columnas para dos niveles",
          "Paredes: block normado con repello, alisado, pintura",
          "Techo: losa de concreto, losa prefabricada",
          "Piso: cerámico, granito, porcelanato",
          "Ventanas: aluminio, uPVC",
          "Puertas: madera tratada, metal, prefabricadas",
          "Servicios: agua, luz, drenajes, cable de TV, internet",
          "Exterior: fachada con diseño arquitectónico",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Mampostería reforzada con columnas para dos niveles"
        ],
        recubrimientos: [
          "Block normado con repello, alisado, pintura"
        ],
        cubiertas: [
          "Losa de concreto",
          "Losa prefabricada"
        ],
        pisos: [
          "Cerámico",
          "Granito",
          "Porcelanato"
        ],
        puertasVentanas: [
          "Aluminio",
          "uPVC",
          "Madera tratada",
          "Metal",
          "Prefabricadas"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes",
          "Cable de TV",
          "Internet"
        ],
        diseno: [
          "Fachada con diseño arquitectónico"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },

      // =============================================
      // CATEGORÍA ALTA - TIPOLOGÍA ALTA
      // =============================================
      {
        id: "alta-alta-1",
        category: "Alta",
        type: "Alta",
        title: "Tipología Alta - Variante 1",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/tipolog%C3%ADa%20alta.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/interior%20tipologia%20alta.png",
        pricePerM2: 2800,
        description: "CATEGORÍA ALTA - TIPOLOGÍA ALTA: Como sistema constructivo encontramos mampostería reforzada con columnas para dos niveles",
        bullets: [
          "Estructura: mampostería reforzada con columnas para dos niveles",
          "Paredes: block normado con repello, alisado, pintura",
          "Techo: losa de concreto, losa prefabricada, losas inclinadas",
          "Piso: cerámico, porcelanato",
          "Ventanas: uPVC, aluminio",
          "Puertas: madera tratada, metal, prefabricadas",
          "Servicios: agua, luz, drenajes, cable de TV, internet",
          "Exterior: fachada con diseño arquitectónico",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Sistema de mampostería reforzada",
          "Combinación de columnas-vigas con sistema de muros de carga",
          "Columnas de concreto reforzado"
        ],
        recubrimientos: [
          "Block normado con repello, alisado, pintura"
        ],
        cubiertas: [
          "Losa de concreto",
          "Losa prefabricada",
          "Losas inclinadas"
        ],
        pisos: [
          "Cerámico",
          "Porcelanato"
        ],
        puertasVentanas: [
          "uPVC",
          "Aluminio",
          "Madera tratada",
          "Metal",
          "Prefabricadas"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes",
          "Cable de TV",
          "Internet"
        ],
        diseno: [
          "Fachada con diseño arquitectónico"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      },
      {
        id: "alta-alta-2",
        category: "Alta",
        type: "Alta",
        title: "Tipología Alta - Variante 2",
        img: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/tipologia%20alta%202.png",
        imgInterior: "https://cdn.jsdelivr.net/gh/Senseifizz7/Calcula-Aval-os/main/categoria%20alta/interior%20tipologia%20alta%202.png",
        pricePerM2: 2900,
        description: "CATEGORÍA ALTA - TIPOLOGÍA ALTA: Como sistema constructivo encontramos mampostería reforzada con columnas para dos niveles",
        bullets: [
          "Estructura: mampostería reforzada con columnas para dos niveles",
          "Paredes: block normado con repello, alisado, pintura",
          "Techo: losa de concreto, losa prefabricada, losas inclinadas",
          "Piso: cerámico, porcelanato",
          "Ventanas: uPVC, aluminio",
          "Puertas: madera tratada, metal, prefabricadas",
          "Servicios: agua, luz, drenajes, cable de TV, internet",
          "Exterior: fachada con diseño arquitectónico",
          "Instalaciones: ocultas"
        ],
        sistemasConstructivos: [
          "Mampostería reforzada con columnas para dos niveles"
        ],
        recubrimientos: [
          "Block normado con repello, alisado, pintura"
        ],
        cubiertas: [
          "Losa de concreto",
          "Losa prefabricada",
          "Losas inclinadas"
        ],
        pisos: [
          "Cerámico",
          "Porcelanato"
        ],
        puertasVentanas: [
          "uPVC",
          "Aluminio",
          "Madera tratada",
          "Metal",
          "Prefabricadas"
        ],
        servicios: [
          "Agua",
          "Luz",
          "Drenajes",
          "Cable de TV",
          "Internet"
        ],
        diseno: [
          "Fachada con diseño arquitectónico"
        ],
        acceso: [
          "Adoquín",
          "Pavimento"
        ]
      }
    ];

    function __getTipos(){try{return Array.isArray(window.TIPOLOGIAS)&&window.TIPOLOGIAS.length?window.TIPOLOGIAS:__FALLBACK_TIPOLOGIAS;}catch{return __FALLBACK_TIPOLOGIAS;}}

    // NUEVA FUNCIÓN PARA RENDERIZAR CON PESTAÑAS Y ACORDEONES
    function __renderTipos(){
      const tipologias = __getTipos();
      
      // Agrupar por categoría y tipo
      const grouped = tipologias.reduce((acc, tipologia) => {
        if (!acc[tipologia.category]) {
          acc[tipologia.category] = {};
        }
        if (!acc[tipologia.category][tipologia.type]) {
          acc[tipologia.category][tipologia.type] = [];
        }
        acc[tipologia.category][tipologia.type].push(tipologia);
        return acc;
      }, {});

      // Renderizar cada pestaña
      ['baja', 'media', 'alta'].forEach(categoria => {
        const tabContent = document.getElementById(`tab-${categoria}`);
        if (!tabContent) return;

        let html = '';
        const tipos = grouped[categoria.charAt(0).toUpperCase() + categoria.slice(1)];
        
        if (!tipos) {
          html = '<div style="padding: 40px; text-align: center; color: var(--text-light);"><i class="fas fa-home" style="font-size: 3rem; margin-bottom: 16px;"></i><p>No hay tipologías disponibles para esta categoría</p></div>';
        } else {
          // Ordenar tipos: Baja, Media, Alta
          const tipoOrder = ['Baja', 'Media', 'Alta'];
          tipoOrder.forEach(tipo => {
            if (tipos[tipo]) {
              const rango = RANGOS_PRECIO[categoria.charAt(0).toUpperCase() + categoria.slice(1)]?.[tipo] || { min: 0, max: 0 };
              const rangoTexto = `Q${rango.min.toLocaleString('es-GT')}–Q${rango.max.toLocaleString('es-GT')}/m²`;
              
              html += `
                <div class="typology-accordion">
                  <button class="typology-accordion-header">
                    <span>Tipología ${tipo} - ${rangoTexto}</span>
                    <i class="fas fa-chevron-down typology-accordion-icon"></i>
                  </button>
                  <div class="typology-accordion-content">
                    <div class="typology-variants">
              `;
              
              tipos[tipo].forEach((tipologia, index) => {
                html += `
                  <div class="typology-variant" data-id="${tipologia.id}">
                    <div class="variant-images">
                      <img class="variant-image" src="${tipologia.img}" alt="${tipologia.title}" onclick="event.stopPropagation(); openImageModal('${tipologia.img}', '${tipologia.title}')">
                      ${tipologia.imgInterior ? `<img class="variant-image" src="${tipologia.imgInterior}" alt="Interior ${tipologia.title}" onclick="event.stopPropagation(); openImageModal('${tipologia.imgInterior}', 'Interior ${tipologia.title}')">` : ''}
                    </div>
                    <div class="variant-content">
                      <div class="variant-details">
                        <div class="variant-title">${tipologia.title}</div>
                        <div class="variant-price">Q${tipologia.pricePerM2.toLocaleString('es-GT')}/m²</div>
                        
                        <ul class="variant-features">
                          ${tipologia.bullets.map(bullet => `<li><i class="fas fa-check"></i>${bullet}</li>`).join('')}
                        </ul>
                        
                        ${tipologia.description ? `
                          <div class="variant-description">
                            <strong>Descripción:</strong> ${tipologia.description}
                          </div>
                        ` : ''}
                        
                        <!-- Secciones detalladas -->
                        ${tipologia.sistemasConstructivos ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-hammer"></i> Sistemas Constructivos</h4>
                            <ul>
                              ${tipologia.sistemasConstructivos.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.recubrimientos ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-layer-group"></i> Recubrimientos de Paredes</h4>
                            <ul>
                              ${tipologia.recubrimientos.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.acabados ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-paint-roller"></i> Acabados Interiores y Exteriores</h4>
                            <ul>
                              ${tipologia.acabados.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.cubiertas ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-home"></i> Cubiertas</h4>
                            <ul>
                              ${tipologia.cubiertas.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.cielosFalsos ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-cloud"></i> Cielos Falsos</h4>
                            <ul>
                              ${tipologia.cielosFalsos.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.pisos ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-square"></i> Pisos</h4>
                            <ul>
                              ${tipologia.pisos.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.puertasVentanas ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-door-open"></i> Puertas y Ventanas</h4>
                            <ul>
                              ${tipologia.puertasVentanas.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.diseno ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-drafting-compass"></i> Diseño Arquitectónico</h4>
                            <ul>
                              ${tipologia.diseno.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.servicios ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-tools"></i> Servicios Básicos</h4>
                            <ul>
                              ${tipologia.servicios.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        ${tipologia.acceso ? `
                          <div class="variant-details-section">
                            <h4><i class="fas fa-road"></i> Acceso</h4>
                            <ul>
                              ${tipologia.acceso.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                          </div>
                        ` : ''}
                        
                        <button class="select-button" onclick="event.stopPropagation(); __selectTipo('${tipologia.id}')">
                          <i class="fas fa-hand-pointer"></i> Seleccionar esta tipología
                        </button>
                      </div>
                    </div>
                  </div>
                `;
              });
              
              html += `
                    </div>
                  </div>
                </div>
              `;
            }
          });
        }
        
        tabContent.innerHTML = html;
      });

      // Inicializar acordeones
      initAccordions();
    }

    function initAccordions() {
      document.querySelectorAll('.typology-accordion-header').forEach(header => {
        header.addEventListener('click', () => {
          const accordion = header.parentElement;
          const content = header.nextElementSibling;
          
          // Cerrar otros acordeones en el mismo tab
          const tab = accordion.closest('.typology-tab-content');
          tab.querySelectorAll('.typology-accordion').forEach(acc => {
            if (acc !== accordion) {
              acc.querySelector('.typology-accordion-header').classList.remove('active');
              acc.querySelector('.typology-accordion-content').classList.remove('active');
            }
          });
          
          // Toggle actual
          header.classList.toggle('active');
          content.classList.toggle('active');
        });
      });
    }

    function initTabs() {
      document.querySelectorAll('.typology-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          
          // Remover active de todas las pestañas y contenidos
          document.querySelectorAll('.typology-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.typology-tab-content').forEach(c => c.classList.remove('active'));
          
          // Activar pestaña y contenido actual
          tab.classList.add('active');
          document.getElementById(`tab-${tabName}`).classList.add('active');
        });
      });
    }

    function __selectTipo(id) {
      const s = __getTipos().find(z => z.id === id);
      if (!s) return;
      
      const rango = RANGOS_PRECIO[s.category]?.[s.type] || { min: 500, max: 1000 };
      const rangoTexto = `Q${rango.min.toLocaleString('es-GT')}–Q${rango.max.toLocaleString('es-GT')}/m²`;
      
      const img = document.getElementById('selectedImage');
      const tp = document.getElementById('selectedType');
      const ti = document.getElementById('selectedTitle');
      const pr = document.getElementById('selectedPrice');
      const hd = document.getElementById('typology');
      
      if (img) img.src = s.img;
      if (tp) tp.textContent = `Categoría ${s.category} — ${s.type}`;
      if (ti) ti.textContent = s.title;
      if (pr) pr.textContent = rangoTexto;
      if (hd) hd.value = s.id;
      
      s.pricePerM2 = s.pricePerM2 || rango.max;
      
      if (document.getElementById('resultSection').classList.contains('active')) {
          calculateRealAppraisal();
      }
      
      __closeTypology();
    }

    function __openTypology(){
      const m = document.getElementById('catalogModal');
      const t = document.getElementById('typologyTrigger');
      if(!m) return alert('No se encontró el modal (#catalogModal).');
      m.classList.add('active');
      t?.classList.add('active');
      __renderTipos();
      initTabs();
      
      const hb = e => {
        if(e.target === m){
          __closeTypology();
          m.removeEventListener('click', hb);
        }
      };
      m.addEventListener('click', hb);
      const x = document.getElementById('closeModal');
      if(x) x.onclick = __closeTypology;
    }

    function __closeTypology(){
      const m = document.getElementById('catalogModal');
      const t = document.getElementById('typologyTrigger');
      if(!m) return;
      m.classList.remove('active');
      t?.classList.remove('active');
    }

    window.__openTypology = __openTypology; 
    window.__closeTypology = __closeTypology;

    // Funciones para el visor de imágenes (mantenidas)
    function openImageModal(imageSrc, imageAlt) {
      const modal = document.getElementById('image-viewer-modal');
      const fullSizeImage = document.getElementById('full-size-image');
      
      if (modal && fullSizeImage) {
        fullSizeImage.src = imageSrc;
        fullSizeImage.alt = imageAlt || 'Imagen del catálogo';
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    function closeImageViewer() {
      const modal = document.getElementById('image-viewer-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    function initImageModalEvents() {
      const modal = document.getElementById('image-viewer-modal');
      if (modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal || e.target.classList.contains('modal-close')) {
            closeImageViewer();
          }
        });
      }
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeImageViewer();
        }
      });
    }

    // Funcionalidad para subir imágenes (mantenida)
    function initImageUpload() {
      const uploadArea = document.getElementById('upload-area');
      const fileInput = document.getElementById('image-upload');
      const previewContainer = document.getElementById('image-preview');

      uploadArea.addEventListener('click', () => fileInput.click());

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
      });

      fileInput.addEventListener('change', (e) => {
        handleFiles(e.target.files);
      });
    }

    function handleFiles(files) {
      const previewContainer = document.getElementById('image-preview');
      
      Array.from(files).forEach(file => {
        if (!file.type.startsWith('image/')) {
          alert('Solo se permiten archivos de imagen');
          return;
        }

        if (file.size > 5 * 1024 * 1024) {
          alert('La imagen es demasiado grande. Máximo 5MB.');
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          const imageItem = document.createElement('div');
          imageItem.className = 'image-preview-item';
          imageItem.innerHTML = `
            <img src="${e.target.result}" alt="Preview">
            <button type="button" class="image-preview-remove" onclick="this.parentElement.remove()">
              <i class="fas fa-times"></i>
            </button>
            <div class="image-preview-info">${file.name}</div>
          `;
          previewContainer.appendChild(imageItem);
        };
        reader.readAsDataURL(file);
      });
    }

  </script>

  
</body>
</html>
